<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1a1a2e">
    <title>تغذيتي</title>

    <style>
        /* ══════════════════════════════════════════
           Font Face - Local Font
        ══════════════════════════════════════════ */
        @font-face {
            font-family: 'AppFont';
            src: url('assets/font.ttf') format('truetype'),
                url('assets/font.woff2') format('woff2'),
                url('assets/font.woff') format('woff');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }

        /* ══════════════════════════════════════════
           CSS Variables - Theme Colors
        ══════════════════════════════════════════ */
        :root {
            /* Branding Colors */
            --primary: #6C63FF;
            --primary-light: #8B85FF;
            --primary-dark: #5046E5;
            --secondary: #FF6B9D;
            --accent: #00D9A5;
            --warning: #FFB347;
            --danger: #FF6B6B;

            /* Dark Theme Defaults */
            --bg: #0F0F1A;
            --bg-secondary: #1A1A2E;
            --card: #252542;
            --card-hover: #2D2D4A;
            --text: #FFFFFF;
            --text-secondary: #B8B8D0;
            --muted: #6B6B8D;
            --border: rgba(255, 255, 255, 0.08);
            --shadow: rgba(0, 0, 0, 0.3);
            --blur-bg: rgba(26, 26, 46, 0.85);
            --glass: rgba(255, 255, 255, 0.03);

            /* Design Tokens */
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;
            --radius-full: 999px;

            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;

            --transition-fast: 0.15s ease;
            --transition-normal: 0.25s ease;
            --transition-slow: 0.4s ease;

            --nav-height: 70px;
            --safe-area-bottom: env(safe-area-inset-bottom, 0px);

            /* Typography Scaling */
            --font-scale: 1;

            /* Typography Tokens (Fluid Scale) */
            --font-xs: calc(clamp(0.7rem, 0.65rem + 0.25vw, 0.85rem) * var(--font-scale));
            --font-sm: calc(clamp(0.85rem, 0.8rem + 0.35vw, 1rem) * var(--font-scale));
            --font-md: calc(clamp(1rem, 0.95rem + 0.5vw, 1.25rem) * var(--font-scale));
            --font-lg: calc(clamp(1.25rem, 1.15rem + 0.75vw, 1.5rem) * var(--font-scale));
            --font-xl: calc(clamp(1.5rem, 1.35rem + 1vw, 2rem) * var(--font-scale));
            --font-2xl: calc(clamp(2rem, 1.8rem + 1.5vw, 3rem) * var(--font-scale));
            --font-3xl: calc(clamp(2.5rem, 2.2rem + 2vw, 4rem) * var(--font-scale));
        }

        /* ══════════════════════════════════════════
           Reset & Native Behavior
        ══════════════════════════════════════════ */
        *,
        *::before,
        *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            touch-action: manipulation;
        }

        /* Hide Scrollbars */
        ::-webkit-scrollbar {
            display: none;
            width: 0;
            height: 0;
        }

        html,
        body {
            scrollbar-width: none;
            -ms-overflow-style: none;
            overflow-x: hidden;
        }

        html {
            font-size: 16px;
            height: 100%;
            height: -webkit-fill-available;
        }

        body {
            font-family: 'AppFont', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            min-height: -webkit-fill-available;
            line-height: 1.6;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Prevent pull-to-refresh */
        body {
            overscroll-behavior-y: contain;
        }

        /* ══════════════════════════════════════════
           App Container
        ══════════════════════════════════════════ */
        #app {
            position: relative;
            width: 100%;
            min-height: 100vh;
            min-height: -webkit-fill-available;
            display: flex;
            flex-direction: column;
        }

        /* ══════════════════════════════════════════
           Page Styles
        ══════════════════════════════════════════ */
        .page {
            display: none;
            flex: 1;
            width: 100%;
            min-height: 100vh;
            padding: var(--spacing-md);
            padding-bottom: calc(var(--nav-height) + var(--safe-area-bottom) + var(--spacing-lg));
            opacity: 0;
            transform: translateY(10px);
            transition: opacity var(--transition-normal), transform var(--transition-normal);
        }

        .page.active {
            display: flex;
            flex-direction: column;
            opacity: 1;
            transform: translateY(0);
        }

        /* Full screen pages (no bottom nav) */
        .page.fullscreen {
            padding-bottom: var(--spacing-md);
        }

        /* ══════════════════════════════════════════
           Bottom Navigation
        ══════════════════════════════════════════ */
        #bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: calc(var(--nav-height) + var(--safe-area-bottom));
            padding-bottom: var(--safe-area-bottom);
            background: var(--blur-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: transform var(--transition-normal);
        }

        #bottom-nav.hidden {
            transform: translateY(100%);
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            padding: 8px 4px;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
            position: relative;
            min-width: 0;
            max-width: 80px;
        }

        @media screen and (max-width: 380px) {
            .nav-item .nav-label {
                font-size: 9px;
            }
        }

        @media screen and (max-width: 340px) {
            .nav-item .nav-label {
                display: none;
            }

            .nav-item {
                gap: 0;
            }
        }

        .nav-item:active {
            transform: scale(0.92);
        }

        .nav-item .nav-icon {
            font-size: 24px;
            line-height: 1;
            transition: all var(--transition-fast);
            color: var(--muted);
        }

        .nav-item .nav-label {
            font-size: var(--font-xs);
            font-weight: 500;
            color: var(--muted);
            transition: all var(--transition-fast);
        }

        .nav-item.active .icon {
            color: var(--primary);
            filter: drop-shadow(0 0 5px var(--primary));
            transform: scale(1.1);
        }

        .nav-item.active .nav-label {
            color: var(--primary);
            font-weight: 700;
        }

        .nav-item.active::before {
            content: '';
            position: absolute;
            top: 2px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 4px;
            background: var(--primary);
            border-radius: var(--radius-full);
            box-shadow: 0 0 8px var(--primary);
        }

        @keyframes bounceVertical {

            0%,
            20%,
            50%,
            80%,
            100% {
                transform: translateX(-50%) translateY(0);
            }

            40% {
                transform: translateX(-50%) translateY(-10px);
            }

            60% {
                transform: translateX(-50%) translateY(-5px);
            }
        }

        .vertical-scroll-hint {
            position: fixed;
            bottom: 90px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(15, 15, 26, 0.85);
            color: var(--text);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.4s ease;
            z-index: 900;
            display: flex;
            align-items: center;
            gap: 8px;
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--border);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .vertical-scroll-hint.visible {
            opacity: 1;
            animation: bounceVertical 2.5s infinite;
        }

        /* ══════════════════════════════════════════
           SVG Icon Styles
        ══════════════════════════════════════════ */
        .icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .icon svg {
            width: 100%;
            height: 100%;
            fill: currentColor;
        }

        .icon-xs {
            width: 16px;
            height: 16px;
        }

        .icon-sm {
            width: 20px;
            height: 20px;
        }

        .icon-md {
            width: 24px;
            height: 24px;
        }

        .icon-lg {
            width: 32px;
            height: 32px;
        }

        /* Smart Tags */
        .smart-tag {
            display: inline-flex;
            align-items: center;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 700;
            margin-right: 8px;
            vertical-align: middle;
        }

        .tag-danger {
            background: rgba(255, 107, 107, 0.15);
            color: var(--danger);
            border: 1px solid rgba(255, 107, 107, 0.3);
        }

        .tag-warning {
            background: rgba(255, 179, 71, 0.15);
            color: var(--warning);
            border: 1px solid rgba(255, 179, 71, 0.3);
        }

        .tag-success {
            background: rgba(0, 217, 165, 0.15);
            color: var(--accent);
            border: 1px solid rgba(0, 217, 165, 0.3);
        }

        /* Recipe Button */
        .btn-recipe {
            padding: 8px 12px;
            background: rgba(108, 99, 255, 0.1);
            border: 1px solid rgba(108, 99, 255, 0.3);
            border-radius: 8px;
            color: var(--primary);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-recipe:hover {
            background: rgba(108, 99, 255, 0.2);
            transform: scale(1.05);
        }

        .btn-recipe:active {
            transform: scale(0.95);
        }

        .icon-xl {
            width: 48px;
            height: 48px;
        }

        .icon-xxl {
            width: 64px;
            height: 64px;
        }

        .icon-huge {
            width: 80px;
            height: 80px;
        }

        .icon-primary {
            color: var(--primary);
        }

        .icon-accent {
            color: var(--accent);
        }

        .icon-secondary {
            color: var(--secondary);
        }

        .icon-warning {
            color: var(--warning);
        }

        .icon-muted {
            color: var(--muted);
        }

        .icon-text {
            color: var(--text);
        }

        .nav-item .icon {
            width: 24px;
            height: 24px;
            color: var(--muted);
            transition: all var(--transition-fast);
        }

        .nav-item.active .icon {
            color: var(--primary);
        }

        /* ══════════════════════════════════════════
           Utility Classes
        ══════════════════════════════════════════ */
        .flex {
            display: flex;
        }

        .flex-col {
            flex-direction: column;
        }

        .items-center {
            align-items: center;
        }

        .justify-center {
            justify-content: center;
        }

        .justify-between {
            justify-content: space-between;
        }

        .gap-sm {
            gap: var(--spacing-sm);
        }

        .gap-md {
            gap: var(--spacing-md);
        }

        .gap-lg {
            gap: var(--spacing-lg);
        }

        .text-center {
            text-align: center;
        }

        .text-muted {
            color: var(--muted);
        }

        .w-full {
            width: 100%;
        }

        /* ══════════════════════════════════════════
           Animations
        ══════════════════════════════════════════ */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }
        }

        .animate-fade-in {
            animation: fadeIn var(--transition-normal) ease forwards;
        }

        .animate-slide-up {
            animation: slideUp var(--transition-normal) ease forwards;
        }

        /* ══════════════════════════════════════════
           Onboarding Styles
        ══════════════════════════════════════════ */
        .onboarding-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            min-height: 100vh;
            justify-content: space-between;
            padding: var(--spacing-xl) var(--spacing-md);
        }

        .onboarding-slides {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .onboarding-slide {
            position: absolute;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: var(--spacing-lg);
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .onboarding-slide.active {
            opacity: 1;
            transform: translateX(0);
        }

        .onboarding-slide.prev {
            opacity: 0;
            transform: translateX(-100%);
        }

        .onboarding-icon {
            font-size: 80px;
            margin-bottom: var(--spacing-xl);
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        .onboarding-title {
            font-size: var(--font-xl);
            font-weight: 700;
            color: var(--text);
            margin-bottom: var(--spacing-md);
            line-height: 1.3;
        }

        .onboarding-desc {
            font-size: var(--font-md);
            color: var(--text-secondary);
            line-height: 1.7;
            max-width: 280px;
        }

        .onboarding-footer {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--spacing-lg);
            padding-bottom: env(safe-area-inset-bottom, 20px);
        }

        .onboarding-dots {
            display: flex;
            gap: var(--spacing-sm);
        }

        .onboarding-dot {
            width: 8px;
            height: 8px;
            border-radius: var(--radius-full);
            background: var(--muted);
            transition: all var(--transition-normal);
            cursor: pointer;
        }

        .onboarding-dot.active {
            width: 24px;
            background: var(--primary);
        }

        .onboarding-btn {
            width: 100%;
            max-width: 300px;
            padding: var(--spacing-md) var(--spacing-xl);
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--text);
            border: none;
            border-radius: var(--radius-lg);
            font-size: var(--font-md);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
            box-shadow: 0 4px 15px rgba(108, 99, 255, 0.3);
        }

        .onboarding-btn:active {
            transform: scale(0.97);
            box-shadow: 0 2px 8px rgba(108, 99, 255, 0.2);
        }

        .onboarding-skip {
            background: transparent;
            border: none;
            color: var(--muted);
            font-size: var(--font-sm);
            padding: var(--spacing-sm);
            cursor: pointer;
            transition: color var(--transition-fast);
        }

        .onboarding-skip:active {
            color: var(--text-secondary);
        }

        /* ══════════════════════════════════════════
           Profile Setup Styles
        ══════════════════════════════════════════ */
        .setup-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            padding: var(--spacing-lg) var(--spacing-md);
            padding-bottom: calc(var(--spacing-xl) + env(safe-area-inset-bottom, 20px));
        }

        .setup-header {
            text-align: center;
            margin-bottom: var(--spacing-xl);
        }

        .setup-header h1 {
            font-size: var(--font-lg);
            font-weight: 700;
            color: var(--text);
            margin-bottom: var(--spacing-sm);
        }

        .setup-header p {
            font-size: var(--font-sm);
            color: var(--text-secondary);
        }

        .setup-form {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-lg);
            flex: 1;
        }

        .form-section {
            background: var(--card);
            border-radius: var(--radius-lg);
            padding: var(--spacing-md);
        }

        .form-section-title {
            font-size: var(--font-sm);
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: var(--spacing-md);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .form-row {
            display: flex;
            gap: var(--spacing-md);
        }

        .form-group {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs);
        }

        .form-label {
            font-size: var(--font-xs);
            color: var(--muted);
        }

        .form-input {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            font-size: var(--font-md);
            font-weight: 600;
            color: var(--text);
            text-align: center;
            width: 100%;
            transition: all var(--transition-fast);
            -webkit-appearance: none;
            -moz-appearance: textfield;
            appearance: none;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            background: var(--card-hover);
        }

        .form-input::placeholder {
            color: var(--muted);
        }

        .form-unit {
            font-size: var(--font-xs);
            color: var(--muted);
            text-align: center;
            margin-top: var(--spacing-xs);
        }

        /* Selection Cards */
        .selection-group {
            display: flex;
            gap: var(--spacing-sm);
        }

        .selection-card {
            flex: 1;
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            text-align: center;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .selection-card:active {
            transform: scale(0.97);
        }

        .selection-card.selected {
            border-color: var(--primary);
            background: rgba(108, 99, 255, 0.1);
        }

        .selection-card .card-icon {
            font-size: 28px;
            margin-bottom: var(--spacing-xs);
        }

        .selection-card .card-title {
            font-size: var(--font-sm);
            font-weight: 600;
            color: var(--text);
        }

        .selection-card .card-desc {
            font-size: var(--font-xs);
            color: var(--muted);
            margin-top: var(--spacing-xs);
            line-height: 1.4;
        }

        /* Activity Level Cards */
        .activity-group {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .activity-card {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .activity-card:active {
            transform: scale(0.98);
        }

        .activity-card.selected {
            border-color: var(--primary);
            background: rgba(108, 99, 255, 0.1);
        }

        .activity-card .activity-icon {
            font-size: 24px;
            width: 40px;
            text-align: center;
        }

        .activity-card .activity-info {
            flex: 1;
        }

        .activity-card .activity-title {
            font-size: var(--font-sm);
            font-weight: 600;
            color: var(--text);
        }

        .activity-card .activity-desc {
            font-size: var(--font-xs);
            color: var(--muted);
            margin-top: 2px;
        }

        .activity-card .activity-check {
            width: 20px;
            height: 20px;
            border-radius: var(--radius-full);
            border: 2px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
        }

        .activity-card.selected .activity-check {
            background: var(--primary);
            border-color: var(--primary);
        }

        .activity-card.selected .activity-check::after {
            content: '✓';
            color: white;
            font-size: 12px;
        }

        /* Goal Cards */
        .goal-group {
            display: flex;
            gap: var(--spacing-sm);
        }

        .goal-card {
            flex: 1;
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            text-align: center;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .goal-card:active {
            transform: scale(0.97);
        }

        .goal-card.selected {
            border-color: var(--accent);
            background: rgba(0, 217, 165, 0.1);
        }

        .goal-card .goal-icon {
            font-size: 24px;
            margin-bottom: var(--spacing-xs);
        }

        .goal-card .goal-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text);
        }

        .goal-card .goal-desc {
            font-size: 10px;
            color: var(--muted);
            margin-top: var(--spacing-xs);
            line-height: 1.3;
        }

        /* Submit Button */
        .setup-submit {
            width: 100%;
            padding: var(--spacing-md) var(--spacing-xl);
            background: linear-gradient(135deg, var(--accent), #00B386);
            color: var(--text);
            border: none;
            border-radius: var(--radius-lg);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
            box-shadow: 0 4px 15px rgba(0, 217, 165, 0.3);
            margin-top: var(--spacing-md);
        }

        .setup-submit:active {
            transform: scale(0.97);
        }

        .setup-submit:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Health Conditions */
        .health-group {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-sm);
        }

        .health-card {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: var(--radius-md);
            padding: var(--spacing-sm) var(--spacing-md);
            cursor: pointer;
            transition: all var(--transition-fast);
            flex: 0 0 calc(50% - var(--spacing-xs));
        }

        .health-card:active {
            transform: scale(0.97);
        }

        .health-card.selected {
            border-color: var(--danger);
            background: rgba(255, 107, 107, 0.1);
        }

        .health-card .health-icon {
            width: 24px;
            height: 24px;
            color: var(--muted);
            transition: all var(--transition-fast);
        }

        .health-card.selected .health-icon {
            color: var(--danger);
        }

        .health-card .health-title {
            font-size: 13px;
            font-weight: 500;
            color: var(--text);
            flex: 1;
        }

        .health-card .health-check {
            width: 18px;
            height: 18px;
            border-radius: var(--radius-sm);
            border: 2px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
        }

        .health-card.selected .health-check {
            background: var(--danger);
            border-color: var(--danger);
        }

        .health-card.selected .health-check::after {
            content: '✓';
            color: white;
            font-size: 10px;
        }

        .health-note {
            font-size: 12px;
            color: var(--muted);
            margin-top: var(--spacing-sm);
            line-height: 1.5;
        }

        /* ══════════════════════════════════════════
           Home Page Styles
        ══════════════════════════════════════════ */
        .home-header {
            padding: var(--spacing-md) 0;
            margin-bottom: var(--spacing-md);
        }

        .home-greeting {
            font-size: 24px;
            font-weight: 700;
            color: var(--text);
            margin-bottom: var(--spacing-xs);
        }

        .home-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* Home Cards Global */
        .home-card {
            background: var(--card);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-md);
            position: relative;
            overflow: hidden;
            transition: transform var(--transition-fast);
        }

        .home-card:active {
            transform: scale(0.98);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-md);
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        /* Status Card */
        .status-card {
            background: linear-gradient(135deg, var(--card), var(--bg-secondary));
            border: 1px solid var(--border);
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-xs);
            padding: 6px 12px;
            border-radius: var(--radius-full);
            font-size: 12px;
            font-weight: 600;
        }

        .status-badge.good {
            background: rgba(0, 217, 165, 0.15);
            color: var(--accent);
        }

        .status-badge.attention {
            background: rgba(255, 179, 71, 0.15);
            color: var(--warning);
        }

        .status-text {
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: var(--spacing-sm);
            line-height: 1.5;
        }

        /* Energy Card */
        .energy-card {
            background: var(--card);
        }

        .energy-display {
            display: flex;
            align-items: flex-end;
            gap: var(--spacing-xs);
            margin-bottom: var(--spacing-sm);
        }

        .energy-value {
            font-size: var(--font-2xl);
            font-weight: 800;
            color: var(--primary);
            line-height: 1;
        }

        .energy-unit {
            font-size: var(--font-sm);
            color: var(--muted);
            margin-bottom: 6px;
        }

        .energy-info-btn {
            font-size: var(--font-xs);
            color: var(--primary-light);
            background: none;
            border: none;
            padding: 0;
            cursor: pointer;
            text-decoration: underline;
            opacity: 0.8;
        }

        /* Water Card */
        .water-card {
            background: linear-gradient(180deg, var(--card) 0%, rgba(108, 99, 255, 0.05) 100%);
        }

        .water-progress {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: var(--spacing-md) 0;
        }

        .water-cups {
            display: flex;
            gap: var(--spacing-xs);
            flex-wrap: wrap;
        }

        .cup-icon {
            width: 24px;
            height: 24px;
            color: var(--border);
            transition: all var(--transition-normal);
        }

        .cup-icon.filled {
            color: #4facfe;
            /* Water specific blue */
            filter: drop-shadow(0 0 5px rgba(79, 172, 254, 0.5));
        }

        .water-controls {
            display: flex;
            gap: var(--spacing-md);
            margin-top: var(--spacing-md);
        }

        .btn-water {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-xs);
            padding: 10px;
            border-radius: var(--radius-md);
            border: none;
            font-weight: 600;
            font-size: var(--font-sm);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .btn-add-water {
            background: rgba(79, 172, 254, 0.15);
            color: #4facfe;
        }

        .btn-water-remind {
            background: var(--bg-secondary);
            color: var(--text-secondary);
        }

        /* Tip Card */
        .tip-card {
            background: rgba(255, 107, 107, 0.05);
            border: 1px solid rgba(255, 107, 107, 0.1);
        }

        .tip-content {
            font-size: var(--font-sm);
            color: var(--text);
            line-height: 1.6;
            font-style: italic;
        }

        /* Action Card (Meals) */
        .action-card {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--spacing-md);
            background: var(--card);
            border-radius: var(--radius-md);
            cursor: pointer;
        }

        .action-info {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .action-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-sm);
            background: var(--bg-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
        }

        /* Modal for explanations */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity var(--transition-normal);
        }

        .modal-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .modal {
            background: var(--card);
            width: 90%;
            max-width: 320px;
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            transform: translateY(20px);
            transition: transform var(--transition-normal);
            border: 1px solid var(--border);
        }

        .modal-overlay.active .modal {
            transform: translateY(0);
        }

        .modal-title {
            font-size: var(--font-md);
            font-weight: 700;
            margin-bottom: var(--spacing-sm);
            color: var(--text);
        }

        .modal-content {
            font-size: var(--font-sm);
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: var(--spacing-lg);
        }

        .btn-modal-close {
            width: 100%;
            padding: 12px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
        }

        /* ══════════════════════════════════════════
           Meals Page Styles
        ══════════════════════════════════════════ */
        .meal-section {
            margin-bottom: var(--spacing-lg);
        }

        .meal-header-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--spacing-sm);
        }

        .meal-title-group h3 {
            font-size: var(--font-md);
            font-weight: 700;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .meal-desc {
            font-size: var(--font-sm);
            color: var(--muted);
            margin-top: 4px;
        }

        .meal-card {
            background: var(--card);
            border-radius: var(--radius-lg);
            overflow: hidden;
            border: 1px solid var(--border);
            transition: all var(--transition-normal);
        }

        .meal-card.eaten {
            opacity: 0.7;
            border-color: var(--accent);
        }

        .meal-content {
            padding: var(--spacing-md);
        }

        .food-list {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .food-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-sm);
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            font-size: var(--font-sm);
        }

        .food-info {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .food-cals {
            color: var(--muted);
            font-size: var(--font-xs);
        }

        /* Empty State & Add Buttons */
        .empty-meal {
            text-align: center;
            padding: var(--spacing-md) 0;
            color: var(--muted);
            font-size: var(--font-sm);
        }

        .btn-add-food {
            width: 100%;
            padding: 12px;
            margin-top: var(--spacing-sm);
            background: transparent;
            border: 2px dashed var(--border);
            border-radius: var(--radius-md);
            color: var(--text-secondary);
            font-size: var(--font-sm);
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
        }

        .btn-add-food:active {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--primary);
            color: var(--primary);
        }

        .btn-delete-food {
            background: rgba(255, 107, 107, 0.12);
            color: #ff6b6b;
            border: none;
            width: 26px;
            height: 26px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            margin-right: 10px;
            transition: all var(--transition-fast);
        }

        .btn-delete-food:hover {
            background: #ff6b6b;
            color: white;
        }

        /* Meal Actions Footer */
        .meal-footer {
            display: flex;
            border-top: 1px solid var(--border);
            background: rgba(0, 0, 0, 0.2);
        }

        .meal-action-btn {
            flex: 1;
            padding: 12px;
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: var(--font-xs);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            border-left: 1px solid var(--border);
            transition: color var(--transition-fast);
        }

        .meal-action-btn:last-child {
            border-left: none;
        }

        .meal-action-btn.active {
            color: var(--accent);
            background: rgba(0, 217, 165, 0.1);
        }

        .meal-action-btn:active {
            background: rgba(255, 255, 255, 0.05);
        }

        /* ══════════════════════════════════════════
           Animations
        ══════════════════════════════════════════ */
        @keyframes floatY {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-6px);
            }
        }

        @keyframes pulseSoft {

            0%,
            100% {
                transform: scale(1);
                opacity: 0.9;
            }

            50% {
                transform: scale(1.05);
                opacity: 1;
            }
        }

        @keyframes steamRise {
            0% {
                transform: translateY(0);
                opacity: 0.6;
            }

            100% {
                transform: translateY(-15px);
                opacity: 0;
            }
        }

        @keyframes growBar {
            0% {
                transform: scaleY(0.4);
            }

            100% {
                transform: scaleY(1);
            }
        }

        .anim-float {
            animation: floatY 3s ease-in-out infinite;
        }

        .anim-pulse {
            animation: pulseSoft 3s ease-in-out infinite;
        }

        .anim-steam {
            animation: steamRise 2s linear infinite;
        }

        .anim-grow {
            transform-origin: bottom;
            animation: growBar 2s ease-in-out infinite alternate;
        }

        @keyframes neonPulseCyan {

            0%,
            100% {
                text-shadow: 0 0 5px #00f2fe, 0 0 10px #00f2fe, 0 0 20px #00f2fe;
                color: #fff;
            }

            50% {
                text-shadow: 0 0 2px #00f2fe, 0 0 5px #00f2fe, 0 0 10px #00f2fe;
                color: #cef;
            }
        }

        @keyframes neonPulsePurple {

            0%,
            100% {
                text-shadow: 0 0 5px #bf5af2, 0 0 10px #bf5af2, 0 0 20px #bf5af2;
                color: #fff;
            }

            50% {
                text-shadow: 0 0 2px #bf5af2, 0 0 5px #bf5af2, 0 0 10px #bf5af2;
                color: #f9f;
            }
        }

        .neon-text-cyan {
            animation: neonPulseCyan 2s infinite;
            font-weight: 800;
            letter-spacing: 0.5px;
        }

        .neon-text-purple {
            animation: neonPulsePurple 2s infinite;
            font-weight: 800;
            letter-spacing: 0.5px;
        }

        /* Premium About Page Animations */
        @keyframes float {
            0% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-10px);
            }

            100% {
                transform: translateY(0px);
            }
        }

        @keyframes glassShimmer {
            0% {
                background-position: -200% 0;
            }

            100% {
                background-position: 200% 0;
            }
        }

        .floating {
            animation: float 6s ease-in-out infinite;
        }

        .premium-glass {
            background: var(--glass);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }

        .premium-glass::after {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 50%;
            height: 100%;
            background: linear-gradient(to right, transparent, rgba(255, 255, 255, 0.05), transparent);
            transform: skewX(-25deg);
            animation: glassShimmer 8s infinite;
        }

        .hero-glow {
            position: absolute;
            width: 200px;
            height: 200px;
            background: var(--primary);
            filter: blur(80px);
            opacity: 0.15;
            pointer-events: none;
            z-index: 0;
        }

        .calc-age-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .calc-age-card.active {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2), 0 0 15px var(--primary-light);
        }

        .dev-badge {
            display: inline-flex;
            align-items: center;
            padding: 2px 8px;
            background: rgba(0, 242, 254, 0.1);
            border: 1px solid rgba(0, 242, 254, 0.2);
            border-radius: 4px;
            font-size: var(--font-xs);
            margin-right: 8px;
            color: #00f2fe;
            font-weight: 700;
        }

        .sup-badge {
            display: inline-flex;
            align-items: center;
            padding: 2px 8px;
            background: rgba(191, 90, 242, 0.1);
            border: 1px solid rgba(191, 90, 242, 0.2);
            border-radius: 4px;
            font-size: var(--font-xs);
            margin-right: 8px;
            color: #bf5af2;
            font-weight: 700;
        }

        /* Success Animation for Saving */
        @keyframes successPop {
            0% {
                transform: scale(0.8);
                opacity: 0;
            }

            50% {
                transform: scale(1.1);
                opacity: 1;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes checkmarkGlow {
            0% {
                filter: drop-shadow(0 0 0 rgba(79, 172, 254, 0));
            }

            50% {
                filter: drop-shadow(0 0 15px var(--primary));
            }

            100% {
                filter: drop-shadow(0 0 0 rgba(79, 172, 254, 0));
            }
        }

        .save-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(8px);
            z-index: 9999;
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 20px;
        }

        .success-checkmark {
            width: 80px;
            height: 80px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            animation: successPop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275), checkmarkGlow 1.5s infinite;
        }

        /* Modal & Delete Styles */
        /* Modal & Tabs Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background: var(--card);
            padding: 30px;
            border-radius: var(--radius-xl);
            width: 100%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 10px 40px var(--shadow);
            border: 1px solid var(--border);
            animation: modalPop 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        @keyframes modalPop {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(20px);
            }

            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .qc-tabs {
            display: flex;
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 4px;
            margin-bottom: 20px;
        }

        .qc-tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            border-radius: 10px;
            font-size: var(--font-sm);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-secondary);
        }

        .qc-tab.active {
            background: var(--primary);
            color: white;
        }

        .qc-input-group {
            margin-bottom: 15px;
            text-align: right;
        }

        .qc-input-label {
            display: block;
            font-size: var(--font-xs);
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .quick-calc-input {
            width: 100%;
            padding: 12px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text);
            font-size: var(--font-md);
            outline: none;
            text-align: center;
        }

        .qc-result-box {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            padding: 20px;
            border-radius: 16px;
            color: white;
            margin: 20px 0;
            display: none;
            text-align: center;
        }

        .qc-result-box.active {
            display: block;
            animation: slideIn 0.3s ease;
        }

        /* Meal List Animations */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideOut {
            from {
                opacity: 1;
                transform: translateX(0);
            }

            to {
                opacity: 0;
                transform: translateX(20px);
            }
        }

        .meal-section {
            animation: slideIn 0.3s ease-out;
        }

        .food-item {
            animation: slideIn 0.3s ease-out forwards;
        }

        .food-item.removing {
            animation: slideOut 0.3s ease-in forwards;
        }

        /* Planner Styles */
        .planner-header {
            position: sticky;
            top: 0;
            background: var(--bg);
            z-index: 10;
            padding-bottom: var(--spacing-md);
            border-bottom: 1px solid var(--border);
        }

        .search-bar {
            width: 100%;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            padding: 12px 16px;
            border-radius: var(--radius-full);
            color: var(--text);
            font-size: var(--font-sm);
            margin-bottom: var(--spacing-md);
        }

        .planner-categories {
            display: flex;
            gap: var(--spacing-sm);
            overflow-x: auto;
            padding-bottom: var(--spacing-sm);
        }

        .category-chip {
            padding: 8px 16px;
            border-radius: var(--radius-full);
            background: var(--card);
            color: var(--text-secondary);
            font-size: var(--font-sm);
            white-space: nowrap;
            cursor: pointer;
            border: 1px solid var(--border);
        }

        .category-chip.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .planner-list {
            margin-top: var(--spacing-md);
        }

        .planner-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background: var(--card);
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-sm);
            border: 1px solid var(--border);
        }

        .planner-item-info h4 {
            color: var(--text);
            margin-bottom: 4px;
        }

        .planner-item-details {
            font-size: var(--font-xs);
            color: var(--muted);
        }

        .btn-planner-add {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            cursor: pointer;
        }

        /* Food Details */
        .food-detail-header {
            text-align: center;
            padding: var(--spacing-xl) 0;
            background: linear-gradient(180deg, var(--bg-secondary) 0%, var(--bg) 100%);
            margin: 0 -16px var(--spacing-md) -16px;
        }

        .food-hero-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto var(--spacing-md);
            color: var(--primary);
        }

        .fd-subtitle {
            color: var(--muted);
            font-size: var(--font-md);
        }

        .detail-card {
            background: var(--card);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-md);
            border: 1px solid var(--border);
        }

        .best-time-tag {
            display: inline-block;
            background: rgba(108, 99, 255, 0.1);
            color: var(--primary-light);
            padding: 4px 12px;
            border-radius: var(--radius-full);
            font-size: var(--font-xs);
            margin-top: var(--spacing-sm);
        }

        .nutri-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
        }

        .nutri-item {
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .btn-fit-check {
            width: 100%;
            padding: 16px;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            color: var(--text);
            font-weight: 600;
            cursor: pointer;
            margin-bottom: var(--spacing-md);
            text-align: left;
            display: flex;
            justify-content: space-between;
        }

        .fit-result {
            background: var(--bg-secondary);
            padding: var(--spacing-md);
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-md);
            font-size: var(--font-sm);
            line-height: 1.6;
            margin-bottom: 80px;
            /* Space for fixed button */
        }

        .fit-result.hidden {
            display: none;
        }

        .bottom-action-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: var(--spacing-md);
            background: var(--card);
            border-top: 1px solid var(--border);
            z-index: 100;
            padding-bottom: calc(var(--spacing-md) + var(--safe-area-bottom));
        }

        .btn-add-main {
            width: 100%;
            padding: 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius-lg);
            font-size: var(--font-md);
            font-weight: 700;
            cursor: pointer;
        }

        /* ══════════════════════════════════════════
           Enhanced Compatibility Styles
        ══════════════════════════════════════════ */
        /* Backdrop filter fallback */
        @supports not (backdrop-filter: blur(20px)) {

            #bottom-nav,
            .premium-glass,
            .blur-bg {
                background: var(--bg-secondary) !important;
            }
        }

        /* Safari-specific fixes */
        @supports (-webkit-touch-callout: none) {
            .page {
                min-height: -webkit-fill-available;
            }
        }

        /* Enhanced button states */
        .btn-water,
        .btn-add-food,
        .btn-planner-add,
        .setup-submit,
        .onboarding-btn {
            -webkit-transform: translateZ(0);
            transform: translateZ(0);
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
        }

        /* Improved focus states for accessibility */
        button:focus-visible,
        input:focus-visible,
        select:focus-visible {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }

        /* SVG icon wrapper for emoji replacements */
        .inline-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            vertical-align: middle;
        }

        .inline-icon svg {
            width: 1em;
            height: 1em;
            fill: currentColor;
            stroke: currentColor;
        }

        .inline-icon.icon-greeting {
            width: 1.2em;
            height: 1.2em;
            margin-right: 4px;
        }

        /* Large visual icons for pages */
        .page-visual-icon {
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
        }

        .page-visual-icon svg {
            width: 100%;
            height: 100%;
        }

        /* Water level indicator icons */
        .water-level-icon {
            font-size: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .water-level-icon svg {
            width: 60px;
            height: 60px;
        }
    </style>
</head>

<body>
    <!-- ══════════════════════════════════════════
         Main App Container
    ══════════════════════════════════════════ -->
    <div id="app">

        <!-- Page: Onboarding -->
        <div id="page-onboarding" class="page fullscreen active">
            <div class="onboarding-container">
                <!-- Slides Container -->
                <div class="onboarding-slides">
                    <!-- Slide 1 -->
                    <div class="onboarding-slide active" data-slide="0">
                        <div class="onboarding-icon icon icon-huge icon-accent">
                            <svg viewBox="0 0 64 64" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round">
                                <path class="anim-float" d="M32 50c-12 0-22-6-22-14h44c0 8-10 14-22 14z" />
                                <path class="anim-float" style="animation-delay: 0.2s"
                                    d="M20 36c-2-8 4-14 10-14s8 6 6 14" />
                                <path class="anim-float" style="animation-delay: 0.5s"
                                    d="M44 36c2-8-4-14-10-14s-8 6-6 14" />
                                <path class="anim-steam" d="M32 20v-8" style="opacity:0" />
                                <path class="anim-steam" d="M24 22v-6" style="animation-delay: 1s; opacity:0" />
                                <path class="anim-steam" d="M40 22v-6" style="animation-delay: 0.5s; opacity:0" />
                            </svg>
                        </div>
                        <h1 class="onboarding-title">نساعدك تفهم أكلك</h1>
                        <p class="onboarding-desc">
                            كل وجبة لها قصة، وإحنا هنا نساعدك تعرف
                            إيش يحتاج جسمك بالضبط بطريقة سهلة وواضحة
                        </p>
                    </div>

                    <!-- Slide 2 -->
                    <div class="onboarding-slide" data-slide="1">
                        <div class="onboarding-icon icon icon-huge icon-secondary">
                            <svg viewBox="0 0 64 64" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round">
                                <circle class="anim-pulse" cx="32" cy="32" r="24" opacity="0.1" fill="currentColor" />
                                <circle cx="32" cy="32" r="24" />
                                <circle cx="22" cy="26" r="3" fill="currentColor" />
                                <circle cx="42" cy="26" r="3" fill="currentColor" />
                                <path d="M22 40q10 10 20 0" />
                                <path class="anim-float" d="M58 20l-6 6M6 20l6 6" />
                            </svg>
                        </div>
                        <h1 class="onboarding-title">صديقك، مو بس تطبيق</h1>
                        <p class="onboarding-desc">
                            معاك خطوة بخطوة، نشجعك ونذكرك
                            بدون تعقيد، هدفنا راحتك صحتك
                        </p>
                    </div>

                    <!-- Slide 3 -->
                    <div class="onboarding-slide" data-slide="2">
                        <div class="onboarding-icon icon icon-huge icon-primary">
                            <svg viewBox="0 0 64 64" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round">
                                <path d="M8 56h48" />
                                <rect class="anim-grow" x="12" y="32" width="8" height="24" rx="2" fill="currentColor"
                                    opacity="0.3" />
                                <rect class="anim-grow" style="animation-delay: 0.2s" x="28" y="20" width="8"
                                    height="36" rx="2" fill="currentColor" opacity="0.6" />
                                <rect class="anim-grow" style="animation-delay: 0.4s" x="44" y="12" width="8"
                                    height="44" rx="2" fill="currentColor" opacity="0.9" />
                                <circle cx="56" cy="8" r="4" fill="currentColor" />
                            </svg>
                        </div>
                        <h1 class="onboarding-title">كل شيء محسوب لك</h1>
                        <p class="onboarding-desc">
                            إحنا نحسب، وأنت تقرر
                            نعطيك الصورة الكاملة وأنت تختار الأفضل لك
                        </p>
                    </div>
                </div>

                <!-- Footer -->
                <div class="onboarding-footer">
                    <!-- Dots -->
                    <div class="onboarding-dots">
                        <div class="onboarding-dot active" data-dot="0" onclick="goToSlide(0)"></div>
                        <div class="onboarding-dot" data-dot="1" onclick="goToSlide(1)"></div>
                        <div class="onboarding-dot" data-dot="2" onclick="goToSlide(2)"></div>
                    </div>

                    <!-- Button -->
                    <button class="onboarding-btn" onclick="handleOnboardingNext()">
                        <span id="onboarding-btn-text">التالي</span>
                    </button>

                    <!-- Skip -->
                    <button class="onboarding-skip" onclick="skipOnboarding()">
                        تخطي
                    </button>
                </div>
            </div>
        </div>

        <!-- Page: Profile Setup -->
        <div id="page-profile-setup" class="page fullscreen">
            <div class="setup-container">
                <!-- Header -->
                <div class="setup-header">
                    <h1>خلينا نتعرف عليك</h1>
                    <p>معلومات بسيطة تساعدنا نفهم احتياجك</p>
                </div>

                <!-- Form -->
                <div class="setup-form">
                    <!-- Basic Info -->
                    <div class="form-section">
                        <div class="form-section-title">
                            <span class="icon icon-sm icon-primary">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                    stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M9 11l3 3L22 4" />
                                    <path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11" />
                                </svg>
                            </span>
                            المعلومات الأساسية
                        </div>

                        <div class="form-group" style="margin-bottom: var(--spacing-md);">
                            <label class="form-label">الاسم (لناديك به)</label>
                            <input type="text" id="input-name" class="form-input" placeholder="مثلاً: محمد"
                                style="text-align: right; padding-right:12px;">
                        </div>

                        <div class="form-group" style="margin-bottom: var(--spacing-md);">
                            <label class="form-label">بداية يومك</label>
                            <div class="input-hint"
                                style="font-size:12px; color:var(--text-secondary); margin-bottom:12px;">اختر أقرب موعد
                                لبدء يومك</div>
                            <div class="selection-group eod-selection"
                                style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
                                <div class="selection-card eod-card" data-eod="2" onclick="selectEOD(2)">
                                    <span style="font-size:14px; font-weight:700;">2 ص</span>
                                </div>
                                <div class="selection-card eod-card" data-eod="3" onclick="selectEOD(3)">
                                    <span style="font-size:14px; font-weight:700;">3 ص</span>
                                </div>
                                <div class="selection-card eod-card" data-eod="4" onclick="selectEOD(4)">
                                    <span style="font-size:14px; font-weight:700;">4 ص</span>
                                </div>
                                <div class="selection-card eod-card" data-eod="5" onclick="selectEOD(5)">
                                    <span style="font-size:14px; font-weight:700;">5 ص</span>
                                </div>
                                <div class="selection-card eod-card" data-eod="6" onclick="selectEOD(6)">
                                    <span style="font-size:14px; font-weight:700;">6 ص</span>
                                </div>
                                <div class="selection-card eod-card" data-eod="7" onclick="selectEOD(7)">
                                    <span style="font-size:14px; font-weight:700;">7 ص</span>
                                </div>
                                <div class="selection-card eod-card" data-eod="8" onclick="selectEOD(8)">
                                    <span style="font-size:14px; font-weight:700;">8 ص</span>
                                </div>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">العمر</label>
                                <input type="number" id="input-age" class="form-input" placeholder="25" min="10"
                                    max="100">
                                <span class="form-unit">سنة</span>
                            </div>
                            <div class="form-group">
                                <label class="form-label">الطول</label>
                                <input type="number" id="input-height" class="form-input" placeholder="170" min="100"
                                    max="250">
                                <span class="form-unit">سم</span>
                            </div>
                            <div class="form-group">
                                <label class="form-label">الوزن</label>
                                <input type="number" id="input-weight" class="form-input" placeholder="70" min="30"
                                    max="300">
                                <span class="form-unit">كجم</span>
                            </div>
                        </div>
                    </div>

                    <!-- Gender -->
                    <div class="form-section">
                        <div class="form-section-title">
                            <span class="icon icon-sm icon-primary">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                    stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="7" r="4" />
                                    <path d="M5.5 21a8.38 8.38 0 0113 0" />
                                </svg>
                            </span>
                            الجنس
                        </div>
                        <div class="selection-group">
                            <div class="selection-card" data-gender="male" onclick="selectGender('male')">
                                <div class="card-icon icon icon-xl icon-primary">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                        stroke-linecap="round" stroke-linejoin="round">
                                        <circle cx="10" cy="14" r="5" />
                                        <path d="M19 5l-5.4 5.4M19 5h-5M19 5v5" />
                                    </svg>
                                </div>
                                <div class="card-title">ذكر</div>
                            </div>
                            <div class="selection-card" data-gender="female" onclick="selectGender('female')">
                                <div class="card-icon icon icon-xl icon-secondary">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                        stroke-linecap="round" stroke-linejoin="round">
                                        <circle cx="12" cy="9" r="5" />
                                        <path d="M12 14v7M9 18h6" />
                                    </svg>
                                </div>
                                <div class="card-title">أنثى</div>
                            </div>
                        </div>
                    </div>

                    <!-- Activity Level -->
                    <div class="form-section">
                        <div class="form-section-title">
                            <span class="icon icon-sm icon-accent">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                    stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="5" r="2" />
                                    <path d="M12 7v6M9 20l3-7 3 7M6 12h12" />
                                </svg>
                            </span>
                            مستوى نشاطك اليومي
                        </div>
                        <div class="activity-group">
                            <div class="activity-card" data-activity="light" onclick="selectActivity('light')">
                                <div class="activity-icon icon icon-lg icon-muted">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                        stroke-linecap="round" stroke-linejoin="round">
                                        <circle cx="12" cy="5" r="2" />
                                        <path d="M12 7v4M8 21l4-10 4 10" />
                                    </svg>
                                </div>
                                <div class="activity-info">
                                    <div class="activity-title">نشاط خفيف</div>
                                    <div class="activity-desc">عمل مكتبي ومشي قليل</div>
                                </div>
                                <div class="activity-check"></div>
                            </div>
                            <div class="activity-card" data-activity="moderate" onclick="selectActivity('moderate')">
                                <div class="activity-icon icon icon-lg icon-warning">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                        stroke-linecap="round" stroke-linejoin="round">
                                        <circle cx="18" cy="18" r="3" />
                                        <circle cx="6" cy="18" r="3" />
                                        <path d="M6 15V6a1 1 0 011-1h4l3 3h5" />
                                        <path d="M18 15V9" />
                                    </svg>
                                </div>
                                <div class="activity-info">
                                    <div class="activity-title">نشاط متوسط</div>
                                    <div class="activity-desc">تمارين 3-4 مرات أسبوعياً</div>
                                </div>
                                <div class="activity-check"></div>
                            </div>
                            <div class="activity-card" data-activity="high" onclick="selectActivity('high')">
                                <div class="activity-icon icon icon-lg icon-accent">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                        stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M6 4v16M18 4v16" />
                                        <path d="M6 8h12M6 16h12" />
                                        <rect x="4" y="6" width="4" height="4" rx="1" fill="currentColor" />
                                        <rect x="16" y="6" width="4" height="4" rx="1" fill="currentColor" />
                                        <rect x="4" y="14" width="4" height="4" rx="1" fill="currentColor" />
                                        <rect x="16" y="14" width="4" height="4" rx="1" fill="currentColor" />
                                    </svg>
                                </div>
                                <div class="activity-info">
                                    <div class="activity-title">نشاط عالي</div>
                                    <div class="activity-desc">تمارين يومية أو عمل بدني</div>
                                </div>
                                <div class="activity-check"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Goal -->
                    <div class="form-section">
                        <div class="form-section-title">
                            <span class="icon icon-sm icon-secondary">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                    stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10" />
                                    <circle cx="12" cy="12" r="6" />
                                    <circle cx="12" cy="12" r="2" />
                                </svg>
                            </span>
                            هدفك
                        </div>
                        <div class="goal-group">
                            <div class="goal-card" data-goal="lose" onclick="selectGoal('lose')">
                                <div class="goal-icon icon icon-lg icon-accent">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                        stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M3 17l6-6 4 4 8-8" />
                                        <path d="M17 7h4v4" />
                                    </svg>
                                </div>
                                <div class="goal-title">إنقاص</div>
                                <div class="goal-desc">تقليل الوزن تدريجياً</div>
                            </div>
                            <div class="goal-card" data-goal="maintain" onclick="selectGoal('maintain')">
                                <div class="goal-icon icon icon-lg icon-primary">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                        stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M12 3v18" />
                                        <path d="M5 12h14" />
                                        <path d="M3 7l3 5-3 5" />
                                        <path d="M21 7l-3 5 3 5" />
                                    </svg>
                                </div>
                                <div class="goal-title">تثبيت</div>
                                <div class="goal-desc">المحافظة على وزنك</div>
                            </div>
                            <div class="goal-card" data-goal="gain" onclick="selectGoal('gain')">
                                <div class="goal-icon icon icon-lg icon-warning">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                        stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M3 7l6 6-4 4 8-8" />
                                        <path d="M21 17l-6-6 4-4-8 8" />
                                        <path d="M14 3h4v4" />
                                        <path d="M10 21H6v-4" />
                                    </svg>
                                </div>
                                <div class="goal-title">زيادة</div>
                                <div class="goal-desc">بناء عضل أو زيادة وزن</div>
                            </div>
                        </div>
                    </div>

                    <!-- Health Conditions -->
                    <div class="form-section">
                        <div class="form-section-title">
                            <span class="icon icon-sm icon-danger" style="color: var(--danger);">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                    stroke-linecap="round" stroke-linejoin="round">
                                    <path
                                        d="M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z" />
                                </svg>
                            </span>
                            هل لديك حالة صحية؟
                        </div>
                        <p class="health-note">اختر الحالات التي تؤثر على نظامك الغذائي (اختياري)</p>
                        <div class="health-group">
                            <div class="health-card" data-condition="diabetes" onclick="toggleHealth('diabetes')">
                                <div class="health-icon icon">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                        stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M12 2.69l5.66 5.66a8 8 0 11-11.31 0z" />
                                        <path d="M12 8v4M12 16h.01" />
                                    </svg>
                                </div>
                                <span class="health-title">السكري</span>
                                <div class="health-check"></div>
                            </div>
                            <div class="health-card" data-condition="blood_pressure"
                                onclick="toggleHealth('blood_pressure')">
                                <div class="health-icon icon">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                        stroke-linecap="round" stroke-linejoin="round">
                                        <path
                                            d="M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z" />
                                    </svg>
                                </div>
                                <span class="health-title">ضغط الدم</span>
                                <div class="health-check"></div>
                            </div>
                            <div class="health-card" data-condition="cholesterol" onclick="toggleHealth('cholesterol')">
                                <div class="health-icon icon">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                        stroke-linecap="round" stroke-linejoin="round">
                                        <circle cx="12" cy="12" r="10" />
                                        <path d="M8 12h8M12 8v8" />
                                    </svg>
                                </div>
                                <span class="health-title">الكولسترول</span>
                                <div class="health-check"></div>
                            </div>
                            <div class="health-card" data-condition="heart" onclick="toggleHealth('heart')">
                                <div class="health-icon icon">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                        stroke-linecap="round" stroke-linejoin="round">
                                        <path
                                            d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0016.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 002 8.5c0 2.3 1.5 4.05 3 5.5l7 7z" />
                                        <path d="M12 5l-1 1 2 2-2 2 1 1" />
                                    </svg>
                                </div>
                                <span class="health-title">أمراض القلب</span>
                                <div class="health-check"></div>
                            </div>
                            <div class="health-card" data-condition="kidney" onclick="toggleHealth('kidney')">
                                <div class="health-icon icon">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                        stroke-linecap="round" stroke-linejoin="round">
                                        <path
                                            d="M8 2c-2 0-4 1-4 4 0 2 1 4 1 6s-1 4-1 6c0 3 2 4 4 4s3-2 4-4c1 2 2 4 4 4s4-1 4-4c0-2-1-4-1-6s1-4 1-6c0-3-2-4-4-4s-3 2-4 4c-1-2-2-4-4-4z" />
                                    </svg>
                                </div>
                                <span class="health-title">أمراض الكلى</span>
                                <div class="health-check"></div>
                            </div>
                            <div class="health-card" data-condition="digestive" onclick="toggleHealth('digestive')">
                                <div class="health-icon icon">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                        stroke-linecap="round" stroke-linejoin="round">
                                        <ellipse cx="12" cy="8" rx="8" ry="5" />
                                        <path d="M4 8v8c0 2.76 3.58 5 8 5s8-2.24 8-5V8" />
                                        <path d="M12 13v3" />
                                    </svg>
                                </div>
                                <span class="health-title">مشاكل الهضم</span>
                                <div class="health-check"></div>
                            </div>
                            <div class="health-card" data-condition="allergies" onclick="toggleHealth('allergies')">
                                <div class="health-icon icon">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                        stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M12 9v2m0 4h.01" />
                                        <path
                                            d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z" />
                                    </svg>
                                </div>
                                <span class="health-title">حساسية طعام</span>
                                <div class="health-check"></div>
                            </div>
                            <div class="health-card" data-condition="pregnant" onclick="toggleHealth('pregnant')">
                                <div class="health-icon icon">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                        stroke-linecap="round" stroke-linejoin="round">
                                        <circle cx="12" cy="5" r="3" />
                                        <path d="M12 8v4" />
                                        <path d="M8 21h8" />
                                        <path d="M9 17c0-2.21 1.79-4 4-4h2c.55 0 1 .45 1 1v4c0 1.1-.9 2-2 2H9" />
                                    </svg>
                                </div>
                                <span class="health-title">حامل/مرضع</span>
                                <div class="health-check"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Submit -->
                    <button class="setup-submit" onclick="saveProfile()">
                        احسب وضبط الإعدادات
                    </button>
                </div>
            </div>
        </div>

        <!-- Page: Home -->
        <div id="page-home" class="page">
            <div class="home-header"
                style="display: flex; justify-content: space-between; align-items: flex-start; padding: 20px;">
                <div id="home-greeting">
                    <div style="font-size: 18px; font-weight: 700;">أهلاً بك 👋</div>
                    <div class="home-subtitle">لنحقق أهدافك الصحية اليوم</div>
                </div>
                <div id="reset-timer-container" class="premium-glass"
                    style="padding: 8px 12px; border-radius: 12px; text-align: center; min-width: 90px; border: 1px solid var(--border); background: rgba(255,255,255,0.02);">
                    <div style="font-size: 10px; opacity: 0.6; margin-bottom: 2px;">يُغلق اليوم خلال</div>
                    <div id="reset-countdown"
                        style="font-family: monospace; font-weight: 800; color: var(--accent); font-size: 15px;">
                        --:--:--</div>
                </div>
            </div>

            <!-- Status Card -->
            <div class="home-card status-card"
                style="background: linear-gradient(135deg, rgba(255, 255, 255, 0.03) 0%, rgba(255, 255, 255, 0.005) 100%); border: 1px solid rgba(255,255,255,0.08); box-shadow: 0 4px 24px rgba(0,0,0,0.15);">
                <div class="card-header">
                    <div class="card-title">
                        <span class="icon icon-md icon-text">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10" />
                                <path d="M12 16v-4" />
                                <path d="M12 8h.01" />
                            </svg>
                        </span>
                        وضعك اليوم
                    </div>
                    <div class="status-badge" id="status-badge">...</div>
                </div>
                <div class="status-text" id="status-text">
                    جاري تحليل بياناتك...
                </div>
                <div class="bmi-display" id="bmi-container"
                    style="margin-top:12px; padding-top:12px; border-top:1px solid var(--border); display:flex; justify-content:space-between; align-items:center;">
                    <div style="display:flex; flex-direction:column; gap:4px;">
                        <div style="font-size:12px; opacity:0.7;">مؤشر كتلة الجسم (BMI)</div>
                        <div style="display:flex; align-items:center; gap:8px;">
                            <span id="bmi-value"
                                style="font-size:18px; font-weight:800; color:var(--primary);">--</span>
                            <span id="bmi-status-badge" class="status-badge hidden"
                                style="font-size:11px; padding:2px 8px; border-radius:12px; border:1px solid transparent;">...</span>
                        </div>
                    </div>
                    <button onclick="showQuickCalculator()"
                        style="background:var(--bg-secondary); border:none; padding:4px 12px; border-radius:8px; color:var(--text); font-size:11px; cursor:pointer;">حساب
                        سريع</button>
                </div>
            </div>

            <!-- Energy Card -->
            <div class="home-card energy-card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="icon icon-md icon-primary">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round">
                                <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z" />
                            </svg>
                        </span>
                        الطاقة المتبقية
                    </div>
                    <button class="energy-info-btn" onclick="showEnergyExplanation()">ما معنى هذا؟</button>
                </div>
                <div class="energy-display">
                    <div class="energy-value" id="energy-remaining">--</div>
                    <div class="energy-unit">سعرة</div>
                </div>
                <div class="home-subtitle">من أصل <span id="energy-total">--</span> سعرة يومياً</div>
            </div>

            <!-- Water Card -->
            <div class="home-card water-card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="icon icon-md" style="color: #4facfe;">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 2.69l5.66 5.66a8 8 0 11-11.31 0z" />
                            </svg>
                        </span>
                        الماء
                    </div>
                    <div class="status-badge" style="background: rgba(79, 172, 254, 0.1); color: #4facfe;"
                        id="water-count-badge">0 / 0 كوب</div>
                </div>
                <div class="water-progress" id="water-cups-container">
                    <!-- Cups will be generated here -->
                </div>
                <div class="water-controls">
                    <button class="btn-water btn-add-water" onclick="addWater()">
                        <span class="icon icon-sm">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round">
                                <line x1="12" y1="5" x2="12" y2="19" />
                                <line x1="5" y1="12" x2="19" y2="12" />
                            </svg>
                        </span>
                        شربت كوب
                    </button>
                </div>
            </div>

            <!-- Tip Card -->
            <div class="home-card tip-card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="icon icon-md icon-secondary">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round">
                                <path
                                    d="M9.663 17h4.673M12 3a7 7 0 0 1 7 7c0 2.385-1.7 4.478-3.894 5.258H8.894C6.7 14.478 5 12.385 5 10a7 7 0 0 1 7-7z" />
                                <path d="M12 17v4" />
                                <path d="M8 21h8" />
                            </svg>
                        </span>
                        نصيحة اليوم
                    </div>
                </div>
                <div class="tip-content" id="daily-tip">
                    تجنب السكر الأبيض واستبدله بالفواكه الطبيعية لشعور أفضل بالطاقة طويلة الأمد.
                </div>
            </div>

            <!-- Meals Navigation -->
            <div class="action-card" onclick="showPage('page-meals')">
                <div class="action-info">
                    <div class="action-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round" width="24" height="24">
                            <path d="M18 8h1a4 4 0 010 8h-1" />
                            <path d="M2 8h16v9a4 4 0 01-4 4H6a4 4 0 01-4-4V8z" />
                            <line x1="6" y1="1" x2="6" y2="4" />
                            <line x1="10" y1="1" x2="10" y2="4" />
                            <line x1="14" y1="1" x2="14" y2="4" />
                        </svg>
                    </div>
                    <div>
                        <div class="card-title">وجباتك اليوم</div>
                        <div class="home-subtitle">سجل فطورك وغداك وعشاك</div>
                    </div>
                </div>
                <div class="icon icon-sm icon-muted">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <polyline points="15 18 9 12 15 6"></polyline>
                    </svg>
                </div>
            </div>

            <!-- Info Modal -->
            <div class="modal-overlay" id="info-modal" onclick="closeModal(event)">
                <div class="modal" onclick="event.stopPropagation()">
                    <div class="modal-title" id="modal-title">العنوان</div>
                    <div class="modal-content" id="modal-content">المحتوى</div>
                    <button class="btn-modal-close" onclick="closeModal(event)">حسناً</button>
                </div>
            </div>
        </div>

        <!-- Page: Meals -->
        <!-- Page: Meals -->
        <div id="page-meals" class="page">
            <div class="home-header">
                <div class="home-greeting">وجباتك اليوم <span class="inline-icon" style="color: var(--warning);"><svg
                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round" width="20" height="20">
                            <path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 002-2V2" />
                            <path d="M7 2v20" />
                            <path d="M21 15V2v0a5 5 0 00-5 5v6c0 1.1.9 2 2 2h3z" />
                        </svg></span></div>
                <div class="home-subtitle">خطط لوجباتك لتصل لهدفك</div>
            </div>
            <div id="meals-container">
                <!-- Generated by JS -->
            </div>
        </div>

        <!-- Page: Meal Planner -->
        <div id="page-meal-planner" class="page">
            <div class="planner-header">
                <div class="card-header" style="margin-bottom: var(--spacing-sm);">
                    <div class="card-title" onclick="showPage('page-meals')" style="cursor: pointer;">
                        <span class="icon icon-sm"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="19" y1="12" x2="5" y2="12"></line>
                                <polyline points="12 19 5 12 12 5"></polyline>
                            </svg></span>
                        رجوع للوجبات
                    </div>
                </div>

                <div class="planner-categories" style="margin-top: var(--spacing-md);">
                    <div class="category-chip active" onclick="renderPlanner('all')" data-cat="all">الكل</div>
                    <div class="category-chip" onclick="renderPlanner('breakfast')" data-cat="breakfast">فطور</div>
                    <div class="category-chip" onclick="renderPlanner('lunch')" data-cat="lunch">غداء</div>
                    <div class="category-chip" onclick="renderPlanner('dinner')" data-cat="dinner">عشاء</div>
                    <div class="category-chip" onclick="renderPlanner('snack')" data-cat="snack">سناك</div>
                </div>
            </div>
            <div id="planner-list" class="planner-list">
                <!-- Generated by JS -->
            </div>
        </div>

        <!-- Page: Food Categories -->
        <div id="page-food-categories" class="page">
            <!-- Content will be added later -->
        </div>

        <!-- Page: Food List -->
        <div id="page-food-list" class="page">
            <!-- Content will be added later -->
        </div>

        <!-- Food Detail page removed -->


        <!-- Recipe page removed -->


        <!-- Page: Water tracking -->
        <div id="page-water" class="page">
            <div class="setup-header" style="padding: 20px;">
                <h1>تتبع المياه <span class="inline-icon" style="color: #4facfe;"><svg viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            width="24" height="24">
                            <path d="M12 2.69l5.66 5.66a8 8 0 11-11.31 0z" />
                        </svg></span></h1>
                <p>اشرب بذكاء، عش بنشاط</p>
            </div>
            <div class="home-card water-card" style="margin: 20px; text-align: center;">
                <div id="water-progress-visual" class="water-level-icon" style="margin: 30px 0; color: #4facfe;"><svg
                        viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="1" width="60"
                        height="60">
                        <path d="M12 2.69l5.66 5.66a8 8 0 11-11.31 0z" />
                    </svg></div>
                <div id="water-status-text"
                    style="font-size: var(--font-lg); font-weight: 700; color: var(--primary); margin-bottom: 30px;">0 /
                    0 مل
                </div>
                <div style="display: flex; justify-content: center; gap: 20px;">
                    <button onclick="addWater(-250)"
                        style="width: 60px; height: 60px; border-radius: 50%; border: none; background: var(--bg-secondary); color: var(--text); font-size: 24px; cursor: pointer;">-</button>
                    <button onclick="addWater(250)"
                        style="width: 60px; height: 60px; border-radius: 50%; border: none; background: var(--primary); color: white; font-size: 24px; cursor: pointer;">+</button>
                </div>
            </div>
        </div>

        <!-- Page: Master Calculator -->
        <div id="page-calculator" class="page">
            <div class="setup-header" style="padding: 20px 20px 5px 20px; position: relative;">
                <div class="hero-glow" style="top: -20px; right: -20px; background: var(--accent);"></div>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span class="icon" style="color: var(--accent);">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
                            stroke-linecap="round" stroke-linejoin="round" style="width: 24px; height: 24px;">
                            <path d="M12 2v20M2 12h20M4.93 4.93l14.14 14.14M4.93 19.07l14.14-14.14" />
                        </svg>
                    </span>
                    <h1 style="font-size: var(--font-lg); font-weight: 800;">الحاسبة الشاملة</h1>
                </div>
                <p style="opacity: 0.6; font-size: var(--font-xs); margin-top: 4px;">الفحص الصحي العلمي والتدقيق الحيوي
                </p>
            </div>

            <div class="page-content" style="padding: 0 20px 100px 20px;">
                <!-- Segment Control (No Emojis) -->
                <div class="premium-glass"
                    style="margin-bottom: 20px; border-radius: 16px; padding: 5px; display: flex; gap: 5px; border: 1px solid var(--border);">
                    <button id="calc-tab-btn" class="setup-submit"
                        style="flex: 1; height: 36px; padding: 0; font-size: var(--font-sm);"
                        onclick="switchCalcTab('calc')">حساب
                        جديد</button>
                    <button id="hist-tab-btn" class="setup-submit"
                        style="flex: 1; height: 36px; padding: 0; font-size: var(--font-sm); background: transparent; color: var(--text-secondary);"
                        onclick="switchCalcTab('hist')">سجل الفحوصات</button>
                </div>

                <!-- Tab: Calculator -->
                <div id="calc-content">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="font-size: var(--font-sm); font-weight: 700;">بيانات المدقق</h3>
                        <button onclick="calcForMe()"
                            style="background: var(--glass); border: 1px solid var(--primary); color: var(--primary); padding: 6px 14px; border-radius: 12px; font-size: var(--font-xs); font-weight: 700; display: flex; align-items: center; gap: 6px;">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
                                style="width: 14px; height: 14px;">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                                <circle cx="12" cy="7" r="4" />
                            </svg>
                            استيراد بياناتي
                        </button>
                    </div>

                    <!-- Calculator Form -->
                    <div class="home-card" style="padding: 24px; border-radius: 24px; border: 1px solid var(--border);">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 20px;">
                            <div class="input-group">
                                <label
                                    style="font-size: var(--font-xs); margin-bottom: 8px; display: block; opacity: 0.7;">الاسم</label>
                                <input type="text" id="calc-guest-name" placeholder="اختياري"
                                    style="width: 100%; padding: 12px; background: var(--bg); border: 1px solid var(--border); border-radius: 12px; color: var(--text); font-family: inherit;">
                            </div>
                            <div class="input-group">
                                <label
                                    style="font-size: var(--font-xs); margin-bottom: 8px; display: block; opacity: 0.7;">الجنس</label>
                                <select id="calc-guest-gender"
                                    style="width: 100%; padding: 12px; background: var(--bg); border: 1px solid var(--border); border-radius: 12px; color: var(--text); font-family: inherit; font-size: var(--font-sm);">
                                    <option value="male">ذكر</option>
                                    <option value="female">أنثى</option>
                                </select>
                            </div>
                        </div>

                        <div
                            style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 20px;">
                            <div class="input-group">
                                <div
                                    style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                    <label style="font-size: var(--font-xs); opacity: 0.7;">العمر</label>
                                    <span id="age-cat-label"
                                        style="font-size: var(--font-xs); color: var(--accent); font-weight: 800;">بالغ</span>
                                </div>
                                <input type="number" id="calc-guest-age" value="25" oninput="updateAgeCategory()"
                                    style="width: 100%; padding: 12px; background: var(--bg); border: 1px solid var(--border); border-radius: 12px; color: var(--text); font-family: inherit; text-align: center; font-weight: 700;">
                            </div>
                            <div class="input-group">
                                <label
                                    style="font-size: var(--font-xs); margin-bottom: 8px; display: block; opacity: 0.7;">الوزن
                                    (كجم)</label>
                                <input type="number" id="calc-guest-weight" value="70"
                                    style="width: 100%; padding: 12px; background: var(--bg); border: 1px solid var(--border); border-radius: 12px; color: var(--text); font-family: inherit; text-align: center; font-weight: 700;">
                            </div>
                            <div class="input-group">
                                <label
                                    style="font-size: var(--font-xs); margin-bottom: 8px; display: block; opacity: 0.7;">الطول
                                    (سم)</label>
                                <input type="number" id="calc-guest-height" value="170"
                                    style="width: 100%; padding: 12px; background: var(--bg); border: 1px solid var(--border); border-radius: 12px; color: var(--text); font-family: inherit; text-align: center; font-weight: 700;">
                            </div>
                        </div>

                        <div class="input-group" style="margin-bottom: 24px;">
                            <label
                                style="font-size: var(--font-xs); margin-bottom: 8px; display: block; opacity: 0.7;">الجهد
                                البدني الأسبوعي</label>
                            <select id="calc-guest-activity"
                                style="width: 100%; padding: 14px; background: var(--bg); border: 1px solid var(--border); border-radius: 14px; color: var(--text); font-family: inherit; font-size: var(--font-sm);">
                                <option value="1.2">خامل (بلا نشاط رياضي)</option>
                                <option value="1.375">نشاط خفيف (1-3 أيام)</option>
                                <option value="1.55">نشاط متوسط (3-5 أيام)</option>
                                <option value="1.725">نشاط عالي (6-7 أيام)</option>
                                <option value="1.9">نشاط فائق (رياضي محترف)</option>
                            </select>
                        </div>

                        <button class="setup-submit" onclick="runMasterCalc()"
                            style="width: 100%; height: 50px; display: flex; align-items: center; justify-content: center; gap: 10px;">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"
                                style="width: 18px; height: 18px;">
                                <circle cx="11" cy="11" r="8" />
                                <path d="m21 21-4.3-4.3" />
                            </svg>
                            بدء الفحص الشامل
                        </button>
                    </div>

                    <!-- Refined Results Area (No Scroller / Tabbed Logic) -->
                    <div id="calc-results-area" style="display: none; margin-top: 24px;">
                        <h3
                            style="font-size: 15px; font-weight: 700; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                            <svg viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2.5"
                                style="width: 16px; height: 16px;">
                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
                                <polyline points="22 4 12 14.01 9 11.01" />
                            </svg>
                            تقرير التدقيق الحيوي الشامل
                        </h3>

                        <div class="premium-glass"
                            style="padding: 24px; border-radius: 24px; border: 1.5px solid var(--accent); position: relative;">
                            <div class="hero-glow" style="bottom: -20px; left: -20px; opacity: 0.1;"></div>

                            <!-- Main Metric: TDEE -->
                            <div style="text-align: center; margin-bottom: 24px;">
                                <div
                                    style="font-size: 11px; color: var(--accent); font-weight: 800; letter-spacing: 1px; margin-bottom: 4px;">
                                    الاحتياج اليومي للطاقة (TDEE)</div>
                                <div id="calc-res-calories"
                                    style="font-size: var(--font-3xl); font-weight: 900; color: var(--text);">--</div>
                                <div style="font-size: var(--font-xs); opacity: 0.5;">سعرة حرارية / اليوم</div>
                            </div>

                            <!-- Metrics Grid -->
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 24px;">
                                <div
                                    style="padding: 16px; background: rgba(255,255,255,0.03); border-radius: 16px; border: 1px solid var(--border);">
                                    <div style="font-size: var(--font-xs); opacity: 0.5; margin-bottom: 4px;">كتلة الجسم
                                        BMI</div>
                                    <div id="calc-res-bmi" style="font-weight: 800; font-size: var(--font-md);">--</div>
                                </div>
                                <div
                                    style="padding: 16px; background: rgba(255,255,255,0.03); border-radius: 16px; border: 1px solid var(--border);">
                                    <div style="font-size: var(--font-xs); opacity: 0.5; margin-bottom: 4px;">معدل الأيض
                                        BMR</div>
                                    <div id="calc-res-bmr" style="font-weight: 800; font-size: var(--font-md);">--</div>
                                </div>
                                <div
                                    style="padding: 16px; background: rgba(255,255,255,0.03); border-radius: 16px; border: 1px solid var(--border);">
                                    <div style="font-size: var(--font-xs); opacity: 0.5; margin-bottom: 4px;">نسبة
                                        الدهون (تقديري)
                                    </div>
                                    <div id="calc-res-fat" style="font-weight: 800; font-size: var(--font-md);">--</div>
                                </div>
                                <div
                                    style="padding: 16px; background: rgba(255,255,255,0.03); border-radius: 16px; border: 1px solid var(--border);">
                                    <div style="font-size: var(--font-xs); opacity: 0.5; margin-bottom: 4px;">الوزن
                                        المثالي</div>
                                    <div id="calc-res-ideal" style="font-weight: 800; font-size: var(--font-md);">--
                                    </div>
                                </div>
                                <div
                                    style="padding: 16px; background: rgba(255,255,255,0.03); border-radius: 16px; border: 1px solid var(--border);">
                                    <div style="font-size: var(--font-xs); opacity: 0.5; margin-bottom: 4px;">البروتين
                                        اليومي
                                    </div>
                                    <div id="calc-res-protein" style="font-weight: 800; font-size: var(--font-md);">--
                                    </div>
                                </div>
                                <div
                                    style="padding: 16px; background: rgba(255,255,255,0.03); border-radius: 16px; border: 1px solid var(--border);">
                                    <div style="font-size: var(--font-xs); opacity: 0.5; margin-bottom: 4px;">شرب الماء
                                    </div>
                                    <div id="calc-res-water" style="font-weight: 800; font-size: var(--font-md);">--
                                    </div>
                                </div>
                            </div>

                            <button onclick="saveCalcToHistory()"
                                style="width: 100%; background: var(--primary); color: white; border: none; padding: 14px; border-radius: 16px; font-size: 14px; font-weight: 700; display: flex; align-items: center; justify-content: center; gap: 8px;">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
                                    style="width: 16px; height: 16px;">
                                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" />
                                    <polyline points="17 21 17 13 7 13 7 21" />
                                    <polyline points="7 3 7 8 15 8" />
                                </svg>
                                حفظ الفحص في السجل
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Tab: History (Strict SVG) -->
                <div id="hist-content" style="display: none;">
                    <h3 style="font-size: var(--font-sm);">السجلات المحفوظة</h3>
                    <button onclick="clearCalcHistory()"
                        style="color: var(--danger); background: none; border: none; font-size: var(--font-xs); font-weight: 600;">مسح
                        الكل <span class="inline-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="14" height="14">
                                <path d="M3 6h18" />
                                <path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2" />
                                <line x1="10" y1="11" x2="10" y2="17" />
                                <line x1="14" y1="11" x2="14" y2="17" />
                            </svg></span></button>
                </div>
                <div id="calc-history-list" style="display: grid; gap: 12px;">
                    <!-- History items here -->
                    <div style="padding: 30px; text-align: center; opacity: 0.4;">
                        <div class="page-visual-icon" style="margin-bottom: 10px; color: var(--text-secondary);"><svg
                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
                                stroke-linecap="round" stroke-linejoin="round">
                                <path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z" />
                            </svg></div>
                        <div style="font-size: var(--font-xs);">لا توجد سجلات محفوظة</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="page-statistics" class="page">
        <div class="setup-header" style="padding: 20px;">
            <h1>إحصائياتك <span class="inline-icon" style="color: var(--primary);"><svg viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="24"
                        height="24">
                        <line x1="18" y1="20" x2="18" y2="10" />
                        <line x1="12" y1="20" x2="12" y2="4" />
                        <line x1="6" y1="20" x2="6" y2="14" />
                    </svg></span></h1>
            <p>ملخص أدائك الصحي ورؤى معمقة</p>
        </div>

        <div class="page-content" style="padding: 0 20px 80px 20px;">
            <!-- Key Performance Metrics -->
            <div class="stats-summary"
                style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 20px;">
                <div class="premium-glass"
                    style="padding: 15px; border-radius: 20px; text-align: center; border: 1px solid var(--border);">
                    <div style="font-size: var(--font-xs); color: var(--text-secondary); margin-bottom: 5px;">متوسط
                        السعرات</div>
                    <div id="stat-avg-cal" style="font-size: var(--font-lg); font-weight: 800; color: var(--primary);">0
                    </div>
                    <div id="stat-cal-diff" style="font-size: 10px; margin-top: 4px;">--</div>
                </div>
                <div class="premium-glass"
                    style="padding: 15px; border-radius: 20px; text-align: center; border: 1px solid var(--border);">
                    <div style="font-size: var(--font-xs); color: var(--text-secondary); margin-bottom: 5px;">متوسط
                        الماء</div>
                    <div id="stat-avg-water" style="font-size: var(--font-lg); font-weight: 800; color: #4facfe;">0
                    </div>
                    <div id="stat-water-diff" style="font-size: 10px; margin-top: 4px;">--</div>
                </div>
            </div>

            <!-- Macro Distribution Card -->
            <div class="premium-glass"
                style="padding: 20px; border-radius: 24px; margin-bottom: 20px; border: 1px solid var(--border);">
                <div
                    style="font-size: var(--font-sm); font-weight: 700; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                    <span class="icon icon-sm" style="color: var(--accent);"><svg viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2">
                            <path d="M12 2v20M2 12h20M7 7l10 10M17 7L7 10" />
                        </svg></span>
                    توزيع الماكروز (الأسبوعي)
                </div>
                <div
                    style="display: flex; height: 12px; border-radius: 6px; overflow: hidden; background: var(--bg-secondary); margin-bottom: 15px;">
                    <div id="macro-p-bar" style="width: 30%; background: var(--primary);"></div>
                    <div id="macro-c-bar" style="width: 50%; background: var(--accent);"></div>
                    <div id="macro-f-bar" style="width: 20%; background: var(--secondary);"></div>
                </div>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
                    <div style="text-align: center;">
                        <div style="font-size: 10px; color: var(--text-secondary);">بروتين</div>
                        <div id="stat-p-percent" style="font-size: 13px; font-weight: 700; color: var(--primary);">30%
                        </div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 10px; color: var(--text-secondary);">كارب</div>
                        <div id="stat-c-percent" style="font-size: 13px; font-weight: 700; color: var(--accent);">50%
                        </div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 10px; color: var(--text-secondary);">دهون</div>
                        <div id="stat-f-percent" style="font-size: 13px; font-weight: 700; color: var(--secondary);">20%
                        </div>
                    </div>
                </div>
            </div>

            <!-- Weekly Compliance Check -->
            <div class="premium-glass"
                style="padding: 20px; border-radius: 24px; margin-bottom: 20px; border: 1px solid var(--border);">
                <div
                    style="font-size: var(--font-sm); font-weight: 700; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                    <span class="icon icon-sm" style="color: var(--warning);"><svg viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10" />
                            <path d="M9 12l2 2 4-4" />
                        </svg></span>
                    مدى الالتزام بالأهداف
                </div>
                <div
                    style="display: flex; justify-content: space-around; align-items: flex-end; height: 60px; padding-bottom: 10px;">
                    <div id="compliance-days" style="display: flex; gap: 5px;">
                        <!-- Rendered checkmarks -->
                    </div>
                </div>
                <div id="compliance-text" style="font-size: 11px; text-align: center; opacity: 0.7;">التزمت بأهدافك في 5
                    أيام من آخر 7 أيام.</div>
            </div>

            <!-- Calories Chart -->
            <div class="chart-container"
                style="background: var(--card); padding: 20px; border-radius: 24px; margin-bottom: 20px; border: 1px solid var(--border);">
                <div class="chart-title"
                    style="font-size: var(--font-sm); font-weight: 700; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                    <span class="icon icon-sm" style="color: var(--primary);"><svg viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2">
                            <path d="M18 20V10M12 20V4M6 20v-6" />
                        </svg></span>
                    السعرات (7 أيام)
                </div>
                <div id="cal-chart-svg" style="height: 180px; width: 100%;"></div>
            </div>

            <!-- Water Chart -->
            <div class="chart-container"
                style="background: var(--card); padding: 20px; border-radius: 24px; margin-bottom: 20px; border: 1px solid var(--border);">
                <div class="chart-title"
                    style="font-size: var(--font-sm); font-weight: 700; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                    <span class="icon icon-sm" style="color: #4facfe;"><svg viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2">
                            <path d="M12 2.69l5.66 5.66a8 8 0 11-11.31 0z" />
                        </svg></span>
                    شرب الماء (7 أيام)
                </div>
                <div id="water-chart-svg" style="height: 180px; width: 100%;"></div>
            </div>

            <!-- Detailed History -->
            <h3 style="margin: 24px 0 12px 5px; font-size: var(--font-md); font-weight: 800;">سجل العمليات الدقيق</h3>
            <div
                style="background: var(--card); border-radius: 24px; border: 1px solid var(--border); overflow: hidden;">
                <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                    <thead>
                        <tr style="background: rgba(255,255,255,0.02); color: var(--text-secondary);">
                            <th style="padding: 15px; text-align: right; font-weight: 700;">اليوم</th>
                            <th style="padding: 15px; text-align: center;">سعرات</th>
                            <th style="padding: 15px; text-align: center;">ماء</th>
                            <th style="padding: 15px; text-align: center;">P / C / F</th>
                        </tr>
                    </thead>
                    <tbody id="history-table-body">
                        <!-- Rows rendered here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Page: Challenges -->
    <div id="page-challenges" class="page">
        <div class="setup-header" style="padding: 20px;">
            <h1>التحديات <span class="inline-icon" style="color: var(--warning);"><svg viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="24"
                        height="24">
                        <path d="M6 9H4.5a2.5 2.5 0 010-5H6" />
                        <path d="M18 9h1.5a2.5 2.5 0 000-5H18" />
                        <path d="M4 22h16" />
                        <path d="M10 22V8a2 2 0 00-2-2H6v6a4 4 0 004 4v8z" />
                        <path d="M14 22V8a2 2 0 012-2h2v6a4 4 0 01-4 4v8z" />
                    </svg></span></h1>
            <p>تحدى نفسك وأصدقاءك</p>
        </div>
        <div class="home-card" style="margin: 20px; padding: 40px; text-align: center;">
            <div class="page-visual-icon" style="margin-bottom: 20px; color: var(--warning);"><svg viewBox="0 0 24 24"
                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="8" r="6" />
                    <path d="M15.477 12.89L17 22l-5-3-5 3 1.523-9.11" />
                </svg></div>
            <p style="color: var(--text-secondary); font-size: var(--font-sm);">استعد لتحديات ممتعة مثل "أسبوع بلا سكر"
                أو
                "تحدي 8 أكواب ماء" قريباً جداً!</p>
        </div>
    </div>

    <!-- Page: Focus Mode -->
    <div id="page-focus" class="page fullscreen">
        <div class="setup-container"
            style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; text-align: center; padding: 40px;">
            <h1 style="font-size: var(--font-2xl); margin-bottom: 10px;">وضع التركيز <span class="inline-icon"
                    style="color: var(--accent);"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="28" height="28">
                        <circle cx="12" cy="12" r="10" />
                        <circle cx="12" cy="12" r="6" />
                        <circle cx="12" cy="12" r="2" />
                    </svg></span></h1>
            <p style="color: var(--text-secondary); margin-bottom: 40px;">خصصنا هذا المكان لمساعدتك على النجاح اليوم
            </p>
            <div
                style="width: 100%; max-width: 300px; padding: 30px; background: rgba(255,255,255,0.03); border-radius: 24px; border: 1px solid rgba(255,255,255,0.05);">
                <div class="page-visual-icon" style="margin-bottom: 20px; color: var(--accent);"><svg
                        viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z" />
                        <line x1="4" y1="22" x2="4" y2="15" />
                    </svg></div>
                <button class="setup-submit" onclick="showPage('page-home')">إنهاء اليوم بنجاح</button>
                <p style="font-size: var(--font-xs); color: var(--text-secondary); margin-top: 15px;">سيتم تصفير السعرات
                    لتبدأ
                    يوماً جديداً بنشاط</p>
            </div>
        </div>
    </div>

    <!-- Page: Settings -->
    <div id="page-settings" class="page">
        <div class="setup-header" style="padding: 20px;">
            <h1>الإعدادات <span class="inline-icon" style="color: var(--text-secondary);"><svg viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" width="24" height="24">
                        <circle cx="12" cy="12" r="3" />
                        <path
                            d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" />
                    </svg></span></h1>
            <p>خصص تجربتك بالكامل</p>
        </div>
        <div class="home-card" style="margin: 20px; padding: 0;">
            <div style="padding: 20px; border-bottom: 1px solid var(--border);">
                <div style="margin-bottom: 5px; font-weight: 600;">مظهر التطبيق</div>
                <p style="font-size: var(--font-xs); color: var(--text-secondary);">التطبيق يعمل بالوضع الليلي الفاخر
                    حصرياً
                    لضمان أفضل تجربة بصرية</p>
            </div>

            <!-- Accent Color -->
            <div style="padding: 20px; border-bottom: 1px solid var(--border);">
                <div style="margin-bottom: 15px; font-weight: 600;">لون التطبيق الأساسي</div>
                <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                    <div onclick="setAccent('#6C63FF')" class="color-dot"
                        style="width: 32px; height: 32px; border-radius: 50%; background: #6C63FF; cursor: pointer; border: 2px solid rgba(255,255,255,0.2);">
                    </div>
                    <div onclick="setAccent('#00D9A5')" class="color-dot"
                        style="width: 32px; height: 32px; border-radius: 50%; background: #00D9A5; cursor: pointer;">
                    </div>
                    <div onclick="setAccent('#FF6B9D')" class="color-dot"
                        style="width: 32px; height: 32px; border-radius: 50%; background: #FF6B9D; cursor: pointer;">
                    </div>
                    <div onclick="setAccent('#FFB347')" class="color-dot"
                        style="width: 32px; height: 32px; border-radius: 50%; background: #FFB347; cursor: pointer;">
                    </div>
                    <div onclick="setAccent('#BF5AF2')" class="color-dot"
                        style="width: 32px; height: 32px; border-radius: 50%; background: #BF5AF2; cursor: pointer;">
                    </div>
                    <div onclick="setAccent('#30D158')" class="color-dot"
                        style="width: 32px; height: 32px; border-radius: 50%; background: #30D158; cursor: pointer;">
                    </div>
                </div>
            </div>

            <!-- Font Size Scaling -->
            <div style="padding: 20px; border-bottom: 1px solid var(--border);">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <div style="font-weight: 600;">حجم الخط</div>
                    <div id="font-scale-value"
                        style="font-size: var(--font-xs); color: var(--primary); font-weight: 700;">100%</div>
                </div>
                <input type="range" id="font-scale-slider" min="0.8" max="1.3" step="0.05" value="1"
                    oninput="updateFontScale(this.value)"
                    style="width: 100%; height: 6px; background: var(--bg-secondary); border-radius: 3px; appearance: none; cursor: pointer; outline: none;">
                <style>
                    #font-scale-slider::-webkit-slider-thumb {
                        appearance: none;
                        width: 20px;
                        height: 20px;
                        background: var(--primary);
                        border-radius: 50%;
                        cursor: pointer;
                        box-shadow: 0 0 10px rgba(108, 99, 255, 0.3);
                    }
                </style>
            </div>

            <!-- Other Settings -->
            <div style="padding: 20px; border-bottom: 1px solid var(--border); cursor: pointer;"
                onclick="showPage('page-profile-setup')">تعديل ملفي الشخصي</div>
            

    </div>
    </div>

    <div id="page-about" class="page">
        <div class="setup-header" style="padding: 20px 20px 10px 20px; position: relative; overflow: hidden;">
            <div class="hero-glow" style="top: -20px; left: -20px;"></div>
            <div style="display: flex; align-items: center; gap: 12px;">
                <span class="icon" style="color: var(--primary);">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"
                        stroke-linejoin="round" style="width: 28px; height: 28px;">
                        <path d="M9 18h6"></path>
                        <path d="M10 22h4"></path>
                        <path
                            d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7z">
                        </path>
                    </svg>
                </span>
                <h1 style="font-size: var(--font-lg); font-weight: 800; letter-spacing: -0.5px; ">عن التطبيق</h1>
            </div>

        </div>

        <div class="page-content" style="padding: 0 20px 100px 20px;">
            <!-- Premium Team Section: Executive Cards -->
            <div style="display: grid; gap: 16px; margin-bottom: 24px;">
                <!-- Developer - Executive Card -->
                <div class="premium-glass floating"
                    style="padding: 24px; border-radius: 28px; position: relative; border: 1px solid rgba(0, 242, 254, 0.2); background: linear-gradient(145deg, rgba(15, 15, 26, 0.8), rgba(0, 242, 254, 0.03)); overflow: hidden;">
                    <div class="hero-glow" style="top: -20px; right: -20px; background: #00f2fe; opacity: 0.1;"></div>
                    <div style="display: flex; align-items: center; gap: 16px;">
                        <div
                            style="width: 54px; height: 54px; border-radius: 18px; background: rgba(0, 242, 254, 0.1); display: flex; align-items: center; justify-content: center; border: 1px solid rgba(0, 242, 254, 0.2);">
                            <svg viewBox="0 0 24 24" fill="none" stroke="#00f2fe" stroke-width="2"
                                style="width: 28px; height: 28px;">
                                <polyline points="16 18 22 12 16 6"></polyline>
                                <polyline points="8 6 2 12 8 18"></polyline>
                            </svg>
                        </div>
                        <div style="flex: 1;">
                            <span
                                style="font-size: var(--font-xs); text-transform: uppercase; letter-spacing: 1.5px; color: #00f2fe; font-weight: 800; opacity: 0.8; display: block; margin-bottom: 2px;">هندسة
                                الرؤية الرقمية</span>
                            <h2
                                style="font-size: var(--font-md); font-weight: 900; color: var(--text); letter-spacing: -0.5px;">
                                حامد العريقي</h2>
                        </div>
                        <a href="https://instagram.com/hamedareqi" target="_blank"
                            style="padding: 6px 12px; border-radius: 12px; background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888); border: none; display: flex; align-items: center; gap: 6px; color: white; text-decoration: none; font-size: 11px; font-weight: 700; box-shadow: 0 4px 12px rgba(220, 39, 67, 0.3);">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
                                style="width: 14px; height: 14px;">
                                <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
                                <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
                                <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
                            </svg>
                            insta
                        </a>
                    </div>
                </div>

                <!-- Medical Supervisor - Executive Card -->
                <div class="premium-glass floating"
                    style="padding: 24px; border-radius: 28px; position: relative; border: 1px solid rgba(191, 90, 242, 0.2); background: linear-gradient(145deg, rgba(15, 15, 26, 0.8), rgba(191, 90, 242, 0.03)); overflow: hidden;">
                    <div class="hero-glow" style="top: -20px; right: -20px; background: #bf5af2; opacity: 0.1;"></div>
                    <div style="display: flex; align-items: center; gap: 16px;">
                        <div
                            style="width: 54px; height: 54px; border-radius: 18px; background: rgba(191, 90, 242, 0.1); display: flex; align-items: center; justify-content: center; border: 1px solid rgba(191, 90, 242, 0.2);">
                            <svg viewBox="0 0 24 24" fill="none" stroke="#bf5af2" stroke-width="2"
                                style="width: 28px; height: 28px;">
                                <path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>
                            </svg>
                        </div>
                        <div style="flex: 1;">
                            <span
                                style="font-size: var(--font-xs); text-transform: uppercase; letter-spacing: 1.5px; color: #bf5af2; font-weight: 800; opacity: 0.8; display: block; margin-bottom: 2px;">التدقيق
                                الطبي التخصصي</span>
                            <h2
                                style="font-size: var(--font-md); font-weight: 900; color: var(--text); letter-spacing: -0.5px;">
                                د. نهى عراف</h2>
                        </div>
                        <a href="https://instagram.com/nazaz.0" target="_blank"
                            style="padding: 6px 12px; border-radius: 12px; background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888); border: none; display: flex; align-items: center; gap: 6px; color: white; text-decoration: none; font-size: 11px; font-weight: 700; box-shadow: 0 4px 12px rgba(220, 39, 67, 0.3);">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
                                style="width: 14px; height: 14px;">
                                <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
                                <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
                                <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
                            </svg>
                            insta
                        </a>
                    </div>
                </div>
            </div>

            <!-- Philosophy & Standards -->
            <div class="home-card"
                style="padding: 28px; border-radius: 32px; line-height: 1.8; border: 1px solid var(--border); background: var(--card);">
                <div style="text-align: center; margin-bottom: 24px;">
                    <div
                        style="width: 40px; height: 3px; background: var(--primary); border-radius: 2px; margin: 0 auto 16px;">
                    </div>
                    <h3 style="font-size: var(--font-md); font-weight: 800; color: var(--text);">الميثاق الصحي للمنصة
                    </h3>
                    <p style="font-size: var(--font-xs); color: var(--text-secondary); opacity: 0.8; margin-top: 8px;">
                        نحو مستقبل
                        صحي قائم على البرهان العلمي</p>
                </div>

                <p style="font-size: 14px; color: var(--text-secondary); text-align: justify; margin-bottom: 28px;">
                    صُمم "تغذيتي" ليكون المحرك الذكي في رحلتك الصحية، حيث نقوم بتحويل التعقيدات الطبية إلى بيانات مبسطة
                    تمنحك القدرة على اتخاذ قرارات واعية. رؤيتنا تدمج بين دقة الحسابات الفسيولوجية وسهولة التطبيق اليومي
                    لتحقيق التوازن المستدام.
                </p>

                <div style="display: grid; gap: 14px;">
                    <div
                        style="padding: 16px; background: var(--bg-secondary); border-radius: 20px; border: 1px solid var(--border); display: flex; align-items: center; gap: 14px;">
                        <div
                            style="width: 32px; height: 32px; border-radius: 10px; background: rgba(108, 99, 255, 0.1); display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                            <svg viewBox="0 0 24 24" fill="none" stroke="var(--primary)" stroke-width="2.5"
                                style="width: 16px; height: 16px;">
                                <path d="M12 2v20M2 12h20"></path>
                            </svg>
                        </div>
                        <div style="font-size: var(--font-xs); color: var(--text); font-weight: 600;">بروتوكول
                            Mifflin-St Jeor
                            للتمثيل الغذائي.</div>
                    </div>
                    <div
                        style="padding: 16px; background: var(--bg-secondary); border-radius: 20px; border: 1px solid var(--border); display: flex; align-items: center; gap: 14px;">
                        <div
                            style="width: 32px; height: 32px; border-radius: 10px; background: rgba(108, 99, 255, 0.1); display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                            <svg viewBox="0 0 24 24" fill="none" stroke="var(--primary)" stroke-width="2.5"
                                style="width: 16px; height: 16px;">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M2 12h20"></path>
                            </svg>
                        </div>
                        <div style="font-size: var(--font-xs); color: var(--text); font-weight: 600;">معايير منظمة الصحة
                            العالمية
                            لكتلة الجسم.</div>
                    </div>
                    <div
                        style="padding: 16px; background: var(--bg-secondary); border-radius: 20px; border: 1px solid var(--border); display: flex; align-items: center; gap: 14px;">
                        <div
                            style="width: 32px; height: 32px; border-radius: 10px; background: rgba(108, 99, 255, 0.1); display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                            <svg viewBox="0 0 24 24" fill="none" stroke="var(--primary)" stroke-width="2.5"
                                style="width: 16px; height: 16px;">
                                <path d="M12 2.69l5.66 5.66a8 8 0 11-11.31 0z"></path>
                            </svg>
                        </div>
                        <div style="font-size: var(--font-xs); color: var(--text); font-weight: 600;">أنظمة الإماهة
                            الدقيقة (كوب =
                            250 مل).</div>
                    </div>
                </div>

                <div
                    style="margin-top: 30px; text-align: center; border-top: 1px solid var(--border); padding-top: 15px;">
                    <div style="font-size: 10px; opacity: 0.4; letter-spacing: 1px; font-weight: 700;">PREMIUM EDITION •
                        V1.6.0</div>
                    <div style="font-size: 9px; opacity: 0.3; margin-top: 4px;">حقوق الملكية الفكرية محفوطة © 2024</div>
                </div>
            </div>
        </div>
    </div>

    </div>

    <!-- Save Success Overlay -->
    <div id="save-success-overlay" class="save-overlay">
        <div class="success-checkmark">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"
                stroke-linejoin="round" style="width: 40px; height: 40px;">
                <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
        </div>
        <div style="font-weight: 800; color: white; font-size: 18px; margin-top: 10px;">تم الحفظ بنجاح</div>
    </div>

    <!-- ══════════════════════════════════════════
         Bottom Navigation Bar
    ══════════════════════════════════════════ -->
    <nav id="bottom-nav" class="hidden">
        <div class="nav-item" data-page="page-home" onclick="showPage('page-home')">
            <span class="icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round">
                    <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path>
                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                </svg>
            </span>
            <span class="nav-label">الرئيسية</span>
        </div>
        <div class="nav-item" data-page="page-meals" onclick="showPage('page-meals')">
            <span class="icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round">
                    <path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"></path>
                    <path d="M7 2v20"></path>
                    <path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3zm0 0v7"></path>
                </svg>
            </span>
            <span class="nav-label">الوجبات</span>
        </div>
        <div class="nav-item" data-page="page-water" onclick="showPage('page-water')">
            <span class="icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round">
                    <path d="M12 2.69l5.66 5.66a8 8 0 11-11.31 0z"></path>
                    <path d="M12 12v4M12 20h.01"></path>
                </svg>
            </span>
            <span class="nav-label">الماء</span>
        </div>
        <div class="nav-item" data-page="page-calculator" onclick="showPage('page-calculator')">
            <span class="icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round">
                    <rect x="4" y="2" width="16" height="20" rx="3" ry="3"></rect>
                    <line x1="8" y1="6" x2="16" y2="6"></line>
                    <line x1="16" y1="14" x2="16" y2="18"></line>
                    <path d="M12 14h.01M8 14h.01M12 18h.01M8 18h.01"></path>
                    <path d="M16 10h.01M12 10h.01M8 10h.01"></path>
                </svg>
            </span>
            <span class="nav-label">الحاسبة</span>
        </div>
        <div class="nav-item" data-page="page-statistics" onclick="showPage('page-statistics')">
            <span class="icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round">
                    <path d="M18 20V10"></path>
                    <path d="M12 20V4"></path>
                    <path d="M6 20v-6"></path>
                    <line x1="2" y1="20" x2="22" y2="20" stroke-width="1.5"></line>
                </svg>
            </span>
            <span class="nav-label">الإحصائيات</span>
        </div>
        <div class="nav-item" data-page="page-settings" onclick="showPage('page-settings')">
            <span class="icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path
                        d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                    </path>
                </svg>
            </span>
            <span class="nav-label">الإعدادات</span>
        </div>
        <div class="nav-item" data-page="page-about" onclick="showPage('page-about')">
            <span class="icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round">
                    <path d="M9 18h6"></path>
                    <path d="M10 22h4"></path>
                    <path
                        d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7z">
                    </path>
                </svg>
            </span>
            <span class="nav-label">حول</span>
        </div>
    </nav>

    <!-- ══════════════════════════════════════════
         JavaScript
    ══════════════════════════════════════════ -->
    <script>
        /* ══════════════════════════════════════════
           Master Calculator Logic (Refined)
        ══════════════════════════════════════════ */
        let lastCalcAudit = null;

        function updateAgeCategory() {
            const ageInput = document.getElementById('calc-guest-age');
            const label = document.getElementById('age-cat-label');
            const age = parseInt(ageInput.value) || 0;

            let cat = 'بالغ';
            if (age < 2) cat = 'رضيع';
            else if (age <= 12) cat = 'طفل (AAP)';
            else if (age <= 18) cat = 'شاب (WHO)';
            else if (age >= 60) cat = 'كبير سن';

            label.innerText = cat;
            return cat;
        }

        function switchCalcTab(tab) {
            const calcBtn = document.getElementById('calc-tab-btn');
            const histBtn = document.getElementById('hist-tab-btn');
            const calcContent = document.getElementById('calc-content');
            const histContent = document.getElementById('hist-content');

            if (tab === 'calc') {
                calcBtn.style.background = 'var(--primary)';
                calcBtn.style.color = 'white';
                histBtn.style.background = 'transparent';
                histBtn.style.color = 'var(--text-secondary)';
                calcContent.style.display = 'block';
                histContent.style.display = 'none';
            } else {
                histBtn.style.background = 'var(--primary)';
                histBtn.style.color = 'white';
                calcBtn.style.background = 'transparent';
                calcBtn.style.color = 'var(--text-secondary)';
                calcContent.style.display = 'none';
                histContent.style.display = 'block';
                renderCalcHistory();
            }
        }

        function setCalcCategory(cat, el) {
            currentCalcCategory = cat;
            document.querySelectorAll('.calc-age-card').forEach(card => {
                card.classList.remove('active');
                card.style.border = '1px solid var(--border)';
            });
            el.classList.add('active');
            el.style.border = '1px solid var(--primary)';

            // Auto-adjust default age for category
            const ageInput = document.getElementById('calc-guest-age');
            if (cat === 'kids') ageInput.value = 7;
            else if (cat === 'youth') ageInput.value = 15;
            else if (cat === 'adults') ageInput.value = 30;
            else if (cat === 'elderly') ageInput.value = 70;
        }

        function calcForMe() {
            const profile = loadData('user_profile');
            if (!profile || !profile.personal) {
                showNotification('يرجى إكمال الملف الشخصي أولاً', 'warning');
                return;
            }

            const p = profile.personal;
            document.getElementById('calc-guest-name').value = p.name || 'أنا';
            document.getElementById('calc-guest-gender').value = p.gender;
            document.getElementById('calc-guest-age').value = p.age;
            document.getElementById('calc-guest-weight').value = p.weight;
            document.getElementById('calc-guest-height').value = p.height;

            // Map activity string to multiplier
            let multiplier = '1.2';
            if (p.activity === 'light') multiplier = '1.375';
            else if (p.activity === 'moderate') multiplier = '1.55';
            else if (p.activity === 'high') multiplier = '1.725';

            document.getElementById('calc-guest-activity').value = multiplier;

            updateAgeCategory();
            runMasterCalc();
        }

        function runMasterCalc() {
            const name = document.getElementById('calc-guest-name').value || 'فحص غير مسمى';
            const gender = document.getElementById('calc-guest-gender').value;
            const age = parseFloat(document.getElementById('calc-guest-age').value);
            const weight = parseFloat(document.getElementById('calc-guest-weight').value);
            const height = parseFloat(document.getElementById('calc-guest-height').value);
            const activity = parseFloat(document.getElementById('calc-guest-activity').value);

            if (!age || !weight || !height) {
                showNotification('يرجى إدخال جميع البيانات المطلوبة', 'warning');
                return;
            }

            // --- Comprehensive Health Audit Engine ---

            // 1. BMI
            const bmi = (weight / ((height / 100) ** 2)).toFixed(1);

            // 2. BMR (Metabolic Foundation)
            let bmr = 0;
            if (age <= 18) {
                // Schofield
                if (age <= 3) bmr = (61.0 * weight) - 51;
                else if (age <= 10) bmr = (gender === 'male') ? (22.7 * weight) + 495 : (22.5 * weight) + 499;
                else bmr = (gender === 'male') ? (17.5 * weight) + 651 : (12.2 * weight) + 746;
            } else {
                // Mifflin-St Jeor
                bmr = (10 * weight) + (6.25 * height) - (5 * age);
                bmr += (gender === 'male') ? 5 : -161;
                if (age >= 60) bmr *= 0.95; // Aging metabolic adjustment
            }

            // 3. TDEE
            const calories = Math.round(bmr * activity);

            // 4. Ideal Weight (Robinson Formula)
            let idealWeight = "";
            const hInches = height * 0.393701;
            if (height > 152.4) {
                const base = (gender === 'male') ? 52 : 49;
                const weightVal = (base + ((gender === 'male' ? 1.9 : 1.7) * (hInches - 60))).toFixed(1);
                idealWeight = `${weightVal} كجم`;
            } else {
                idealWeight = (gender === 'male') ? `${(22 * (height / 100) ** 2).toFixed(1)} كجم` : `${(21.5 * (height / 100) ** 2).toFixed(1)} كجم`;
            }

            // 5. Body Fat % (Deurenberg Formula)
            let fat = 0;
            const sexFactor = (gender === 'male') ? 1 : 0;
            if (age <= 15) {
                fat = (1.51 * bmi) - (0.70 * age) - (3.6 * sexFactor) + 1.4;
            } else {
                fat = (1.20 * bmi) + (0.23 * age) - (10.8 * sexFactor) - 5.4;
            }
            fat = Math.max(2, fat.toFixed(1)); // Min 2%

            // 6. Protein Needs
            const proteinFactor = (activity <= 1.2) ? 0.8 : (activity <= 1.55) ? 1.2 : 1.6;
            const protein = Math.round(weight * proteinFactor);

            // 7. Water (Adjusted)
            const water = (weight * 0.033 + (activity > 1.3 ? 0.5 : 0)).toFixed(1);

            // Update UI (Institutional Style)
            document.getElementById('calc-results-area').style.display = 'block';
            document.getElementById('calc-res-calories').innerText = calories.toLocaleString();
            document.getElementById('calc-res-bmi').innerText = bmi;
            document.getElementById('calc-res-bmr').innerText = `${Math.round(bmr)} سعرة`;
            document.getElementById('calc-res-fat').innerText = `${fat}%`;
            document.getElementById('calc-res-ideal').innerText = idealWeight;
            document.getElementById('calc-res-protein').innerText = `${protein} جرام`;
            document.getElementById('calc-res-water').innerText = `${water} لتر`;

            lastCalcAudit = {
                id: Date.now(),
                name,
                age, weight, height, gender,
                bmi, calories, water, fat, idealWeight, protein,
                date: new Date().toLocaleDateString('ar-EG')
            };

            showNotification('تم اكتمال الفحص الصحي بنجاح');
            document.getElementById('calc-results-area').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function saveCalcToHistory() {
            if (!lastCalcAudit) return;

            // Show Premium Animation
            const overlay = document.getElementById('save-success-overlay');
            overlay.style.display = 'flex';

            setTimeout(() => {
                let history = loadData('calc_history', []);
                history.unshift(lastCalcAudit);
                saveData('calc_history', history.slice(0, 50));

                lastCalcAudit = null;
                document.getElementById('calc-results-area').style.display = 'none';

                // Switch to history tab to show the result
                switchCalcTab('hist');

                setTimeout(() => {
                    overlay.style.display = 'none';
                }, 800);
            }, 500);
        }

        function renderCalcHistory() {
            const list = document.getElementById('calc-history-list');
            const history = loadData('calc_history', []);

            if (history.length === 0) {
                list.innerHTML = `
                    <div style="padding: 60px 30px; text-align: center; opacity: 0.3;">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width: 48px; height: 48px; margin-bottom: 12px;"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"/><polyline points="13 2 13 9 20 9"/></svg>
                        <div style="font-size: 13px;">لا توجد فحوصات مؤرشفة حالياً</div>
                    </div>`;
                return;
            }

            list.innerHTML = history.map(item => `
                <div class="premium-glass" style="padding: 20px; border-radius: 20px; border: 1px solid var(--border);">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                        <div>
                            <div style="font-weight: 800; font-size: 15px; color: var(--primary);">${item.name}</div>
                            <div style="font-size: 11px; opacity: 0.6;">${item.date} • ${item.gender === 'male' ? 'ذكر' : 'أنثى'} • ${item.age} سنة</div>
                        </div>
                        <div style="font-size: 12px; font-weight: 800; background: var(--accent); color: white; padding: 4px 10px; border-radius: 8px;">BMI: ${item.bmi}</div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1.5fr; gap: 10px;">
                        <div style="font-size: 12px; color: var(--text-secondary); display: flex; align-items: center; gap: 6px;">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 12px; height: 12px;"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>
                            ${item.calories} سعرة
                        </div>
                        <div style="font-size: 12px; color: var(--text-secondary); display: flex; align-items: center; gap: 6px;">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 12px; height: 12px;"><circle cx="12" cy="12" r="10"/><path d="M12 8l4 4-4 4M8 12h7"/></svg>
                            الدهون: ${item.fat}%
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function clearCalcHistory() {
            if (confirm('هل أنت متأكد من مسح جميع السجلات المؤرشفة؟')) {
                saveData('calc_history', []);
                renderCalcHistory();
            }
        }
        const STORAGE_PREFIX = 'nutrition_app_';

        function saveData(key, value) {
            try {
                const data = JSON.stringify(value);
                localStorage.setItem(STORAGE_PREFIX + key, data);
                return true;
            } catch (e) {
                console.error('Error saving data:', e);
                return false;
            }
        }

        function loadData(key, defaultValue = null) {
            try {
                const data = localStorage.getItem(STORAGE_PREFIX + key);
                return data ? JSON.parse(data) : defaultValue;
            } catch (e) {
                console.error('Error loading data:', e);
                return defaultValue;
            }
        }

        function clearAllData() {
            try {
                const keys = Object.keys(localStorage);
                keys.forEach(key => {
                    if (key.startsWith(STORAGE_PREFIX)) {
                        localStorage.removeItem(key);
                    }
                });
                return true;
            } catch (e) {
                console.error('Error clearing data:', e);
                return false;
            }
        }

        /* ══════════════════════════════════════════
           Theme & Aesthetics Logic
        ══════════════════════════════════════════ */
        function setAccent(color) {
            document.documentElement.style.setProperty('--primary', color);
            saveData('theme_accent', color);
            updateThemeUI();
        }

        function applyTheme() {
            const accent = loadData('theme_accent', '#6C63FF');
            document.body.classList.remove('light-mode'); // Force dark
            document.documentElement.style.setProperty('--primary', accent);
            updateThemeUI();
        }

        function updateThemeUI() {
            // Sync color dots
            const accent = loadData('theme_accent', '#6C63FF');
            document.querySelectorAll('.color-dot').forEach(dot => {
                if (dot.getAttribute('onclick').includes(accent)) {
                    dot.style.border = '2px solid white';
                    dot.style.transform = 'scale(1.1)';
                } else {
                    dot.style.border = 'none';
                    dot.style.transform = 'scale(1)';
                }
            });
        }

        /* ══════════════════════════════════════════
           Navigation System
        ══════════════════════════════════════════ */
        const pagesWithNav = [
            'page-home',
            'page-meals',
            'page-water',
            'page-calculator',
            'page-statistics',
            'page-settings',
            'page-meal-planner',
            'page-food-categories',
            'page-food-list',
            'page-challenges',
            'page-about'
        ];

        const pagesWithoutNav = [
            'page-onboarding',
            'page-profile-setup',
            'page-food-details',
            'page-focus'
        ];

        let currentPage = 'page-onboarding';

        function showPage(pageId) {
            // Get all pages
            const pages = document.querySelectorAll('.page');
            const bottomNav = document.getElementById('bottom-nav');

            // Hide all pages
            pages.forEach(page => {
                page.classList.remove('active');
            });

            // Show requested page
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.add('active');
                currentPage = pageId;

                // Update bottom nav visibility
                if (pagesWithNav.includes(pageId)) {
                    bottomNav.classList.remove('hidden');
                } else {
                    bottomNav.classList.add('hidden');
                }

                // Update active nav item
                updateNavActive(pageId);

                // Specific page updates
                if (pageId === 'page-home') updateHome();
                if (pageId === 'page-meals') renderMeals();
                if (pageId === 'page-statistics') updateStatisticsPage();
                if (pageId === 'page-water') updateWaterPage();
                if (pageId === 'page-meal-planner') renderPlanner();

                // Scroll to top
                window.scrollTo(0, 0);
            }
        }

        function updateNavActive(pageId) {
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                if (item.dataset.page === pageId) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
        }

        function updateFontScale(val) {
            document.documentElement.style.setProperty('--font-scale', val);
            const percent = Math.round(val * 100);
            const label = document.getElementById('font-scale-value');
            if (label) label.textContent = `${percent}%`;
            saveData('app_font_scale', val);
        }

        function applyFontScale() {
            const savedScale = parseFloat(loadData('app_font_scale')) || 1;
            document.documentElement.style.setProperty('--font-scale', savedScale);
            const slider = document.getElementById('font-scale-slider');
            if (slider) slider.value = savedScale;
            const label = document.getElementById('font-scale-value');
            if (label) label.textContent = `${Math.round(savedScale * 100)}%`;
        }


        function goBack() {
            // Simple back navigation - can be enhanced with history stack
            showPage('page-home');
        }


        /* ══════════════════════════════════════════
           App Initialization
        ══════════════════════════════════════════ */
        function initApp() {
            // Apply saved theme
            applyTheme();

            // Apply saved font scale
            applyFontScale();

            // Check if user has completed onboarding
            const userData = loadData('user_profile');

            if (userData && userData.onboardingComplete) {
                // User exists, go to home
                showPage('page-home');
            } else {
                // New user, show onboarding
                showPage('page-onboarding');
            }
        }

        /* ══════════════════════════════════════════
           Onboarding Functions
        ══════════════════════════════════════════ */
        let currentSlide = 0;
        const totalSlides = 3;

        function goToSlide(index) {
            const slides = document.querySelectorAll('.onboarding-slide');
            const dots = document.querySelectorAll('.onboarding-dot');
            const btnText = document.getElementById('onboarding-btn-text');

            // Update previous slide
            slides[currentSlide].classList.remove('active');
            slides[currentSlide].classList.add('prev');
            dots[currentSlide].classList.remove('active');

            // Update current slide
            currentSlide = index;

            // Remove prev class from all and set active
            setTimeout(() => {
                slides.forEach(slide => slide.classList.remove('prev'));
            }, 50);

            slides[currentSlide].classList.remove('prev');
            slides[currentSlide].classList.add('active');
            dots[currentSlide].classList.add('active');

            // Update button text on last slide
            if (currentSlide === totalSlides - 1) {
                btnText.textContent = 'ابدأ الآن';
            } else {
                btnText.textContent = 'التالي';
            }
        }

        function handleOnboardingNext() {
            if (currentSlide < totalSlides - 1) {
                goToSlide(currentSlide + 1);
            } else {
                // Last slide - go to profile setup
                showPage('page-profile-setup');
            }
        }

        function skipOnboarding() {
            showPage('page-profile-setup');
        }

        // Touch swipe support for onboarding
        let touchStartX = 0;
        let touchEndX = 0;

        function handleTouchStart(e) {
            touchStartX = e.changedTouches[0].screenX;
        }

        function handleTouchEnd(e) {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        }

        function handleSwipe() {
            const threshold = 50;
            const diff = touchStartX - touchEndX;

            if (Math.abs(diff) > threshold) {
                if (diff > 0 && currentSlide < totalSlides - 1) {
                    // Swipe left - next (RTL: this is "next")
                    goToSlide(currentSlide + 1);
                } else if (diff < 0 && currentSlide > 0) {
                    // Swipe right - previous (RTL: this is "back")
                    goToSlide(currentSlide - 1);
                }
            }
        }

        // Initialize on DOM ready
        document.addEventListener('DOMContentLoaded', () => {
            initApp();

            // Add swipe listeners to onboarding
            const onboardingSlides = document.querySelector('.onboarding-slides');
            if (onboardingSlides) {
                onboardingSlides.addEventListener('touchstart', handleTouchStart, false);
                onboardingSlides.addEventListener('touchend', handleTouchEnd, false);
            }

            // Start reset timer
            setInterval(updateResetCountdown, 1000);
            updateResetCountdown();

            setInterval(updateResetCountdown, 1000);
            updateResetCountdown();
        });

        /* ══════════════════════════════════════════
           WebView Compatibility & Reset Logic
        ══════════════════════════════════════════ */

        function updateResetCountdown() {
            const el = document.getElementById('reset-countdown');
            if (!el) return;

            const now = new Date();
            const profile = loadData('user_profile');
            const eodHour = (profile && profile.personal && profile.personal.endOfDay) || 6;

            // Logical date check for auto-reload
            const currentLogicalDate = getLogicalDate();
            if (window._lastLogicalDate && window._lastLogicalDate !== currentLogicalDate) {
                showToast('بداية يوم جديد! يتم الآن تحديث البيانات...');
                setTimeout(() => {
                    window.location.replace(window.location.pathname);
                }, 2000);
                return;
            }
            window._lastLogicalDate = currentLogicalDate;

            let resetTime = new Date(now);
            resetTime.setHours(eodHour, 0, 0, 0);

            if (now >= resetTime) {
                resetTime.setDate(resetTime.getDate() + 1);
            }

            const diff = resetTime - now;
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);

            el.textContent = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        /* ══════════════════════════════════════════
           Profile Setup Functions
        ══════════════════════════════════════════ */
        let selectedGender = null;
        let selectedActivity = null;
        let selectedGoal = null;
        let selectedEOD = 6; // Default to 6 AM
        let selectedHealthConditions = [];

        function selectEOD(val) {
            selectedEOD = val;
            const cards = document.querySelectorAll('.eod-card');
            cards.forEach(card => {
                if (parseInt(card.dataset.eod) === val) card.classList.add('selected');
                else card.classList.remove('selected');
            });
        }

        function toggleHealth(condition) {
            const card = document.querySelector(`.health-card[data-condition="${condition}"]`);
            const index = selectedHealthConditions.indexOf(condition);

            if (index > -1) {
                // Remove condition
                selectedHealthConditions.splice(index, 1);
                card.classList.remove('selected');
            } else {
                // Add condition
                selectedHealthConditions.push(condition);
                card.classList.add('selected');
            }
        }

        function selectGender(gender) {
            selectedGender = gender;
            const cards = document.querySelectorAll('.selection-card[data-gender]');
            cards.forEach(card => {
                if (card.dataset.gender === gender) {
                    card.classList.add('selected');
                } else {
                    card.classList.remove('selected');
                }
            });
        }

        function selectActivity(activity) {
            selectedActivity = activity;
            const cards = document.querySelectorAll('.activity-card');
            cards.forEach(card => {
                if (card.dataset.activity === activity) {
                    card.classList.add('selected');
                } else {
                    card.classList.remove('selected');
                }
            });
        }

        function selectGoal(goal) {
            selectedGoal = goal;
            const cards = document.querySelectorAll('.goal-card');
            cards.forEach(card => {
                if (card.dataset.goal === goal) {
                    card.classList.add('selected');
                } else {
                    card.classList.remove('selected');
                }
            });
        }

        function editProfile() {
            const profile = loadData('user_profile');
            if (!profile || !profile.personal) return;

            const p = profile.personal;
            document.getElementById('input-name').value = p.name || '';
            document.getElementById('input-age').value = p.age || '';
            document.getElementById('input-height').value = p.height || '';
            document.getElementById('input-weight').value = p.weight || '';

            if (p.gender) selectGender(p.gender);
            if (p.activity) selectActivity(p.activity);
            if (p.goal) selectGoal(p.goal);
            if (p.endOfDay !== undefined) selectEOD(p.endOfDay);

            // Health Conditions
            selectedHealthConditions = p.health || [];
            document.querySelectorAll('.health-card').forEach(card => {
                if (selectedHealthConditions.includes(card.dataset.condition)) {
                    card.classList.add('selected');
                } else {
                    card.classList.remove('selected');
                }
            });

            showPage('page-profile-setup');
        }

        function saveProfile() {
            // Get input values
            const name = document.getElementById('input-name').value;
            const age = parseInt(document.getElementById('input-age').value);
            const height = parseInt(document.getElementById('input-height').value);
            const weight = parseFloat(document.getElementById('input-weight').value);

            // Validate inputs
            if (!name || name.trim().length === 0) {
                showToast('يرجى إدخال اسمك');
                return;
            }
            if (!age || age < 0 || age > 150) {
                showToast('يرجى إدخال العمر بشكل صحيح');
                return;
            }
            if (!height || height < 40 || height > 250) {
                showToast('يرجى إدخال الطول بشكل صحيح');
                return;
            }
            if (!weight || weight < 10 || weight > 300) {
                showToast('يرجى إدخال الوزن بشكل صحيح');
                return;
            }
            if (!selectedGender) {
                showToast('يرجى اختيار الجنس');
                return;
            }
            if (!selectedActivity) {
                showToast('يرجى اختيار مستوى النشاط');
                return;
            }
            if (!selectedGoal) {
                showToast('يرجى اختيار الهدف');
                return;
            }

            // Calculate BMR using Mifflin-St Jeor Equation
            let bmr;
            if (selectedGender === 'male') {
                bmr = (10 * weight) + (6.25 * height) - (5 * age) + 5;
            } else {
                bmr = (10 * weight) + (6.25 * height) - (5 * age) - 161;
            }

            // Activity multipliers
            const activityMultipliers = {
                light: 1.375,
                moderate: 1.55,
                high: 1.725
            };

            // Calculate TDEE (Total Daily Energy Expenditure)
            const tdee = Math.round(bmr * activityMultipliers[selectedActivity]);

            // Set target calories based on goal
            let targetCalories;
            let calorieAdjustment = 0;
            switch (selectedGoal) {
                case 'lose':
                    calorieAdjustment = -500;
                    targetCalories = Math.max(1200, tdee - 500);
                    break;
                case 'gain':
                    calorieAdjustment = 300;
                    targetCalories = tdee + 300;
                    break;
                default:
                    targetCalories = tdee;
            }

            // Macros
            const proteinGrams = Math.round(weight * 1.8);
            const fatGrams = Math.round((targetCalories * 0.25) / 9);
            const carbGrams = Math.round((targetCalories - (proteinGrams * 4) - (fatGrams * 9)) / 4);

            // Water Intake ~35ml/kg
            const waterIntake = Math.round(weight * 35);
            const heightM = height / 100;
            const bmi = (weight / (heightM * heightM)).toFixed(1);

            const profile = {
                onboardingComplete: true,
                createdAt: new Date().toISOString(),
                personal: {
                    name,
                    age,
                    height,
                    weight,
                    gender: selectedGender,
                    activity: selectedActivity,
                    goal: selectedGoal,
                    health: selectedHealthConditions,
                    endOfDay: selectedEOD,
                    bmi: bmi
                },
                calculations: {
                    bmr: Math.round(bmr),
                    tdee,
                    targetCalories,
                    calorieAdjustment,
                    proteinGrams,
                    fatGrams,
                    carbGrams,
                    waterIntake
                }
            };

            saveData('user_profile', profile);
            initializeTodayData();
            showPage('page-home');
        }

        function initializeTodayData() {
            const today = getLogicalDate();
            const existingData = loadData('daily_' + today);

            if (!existingData) {
                const todayData = {
                    date: today,
                    meals: {},
                    water: 0,
                    waterCups: 0,
                    totalCalories: 0,
                    totalProtein: 0,
                    totalCarbs: 0,
                    totalFat: 0
                };
                saveData('daily_' + today, todayData);
            }
        }

        // Simple toast notification
        function showToast(message, duration = 3000) {
            // Remove existing toast
            const existingToast = document.querySelector('.toast');
            if (existingToast) {
                existingToast.remove();
            }

            // Create toast element
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            toast.style.cssText = `
                position: fixed;
                bottom: 100px;
                left: 50%;
                transform: translateX(-50%);
                background: var(--card);
                color: var(--text);
                padding: 12px 24px;
                border-radius: 12px;
                font-size: 14px;
                z-index: 9999;
                animation: slideUp 0.3s ease;
                box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            `;

            document.body.appendChild(toast);

            // Remove after duration
            setTimeout(() => {
                toast.style.animation = 'fadeIn 0.3s ease reverse';
                setTimeout(() => toast.remove(), 300);
            }, duration);
        }

        /* ══════════════════════════════════════════
           Home Page Functions
        ══════════════════════════════════════════ */
        function updateHome() {
            const profile = loadData('user_profile');
            if (!profile) return;

            // Greeting SVG icons
            const greetingIcons = {
                wave: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="20" height="20"><path d="M18 11V6a2 2 0 00-2-2a2 2 0 00-2 2v0"/><path d="M14 10V4a2 2 0 00-2-2a2 2 0 00-2 2v2"/><path d="M10 10.5V6a2 2 0 00-2-2a2 2 0 00-2 2v8"/><path d="M18 8a2 2 0 012 2v8a6 6 0 01-6 6H9a6 6 0 01-6-6v-2a2 2 0 012-2h0"/></svg>',
                sun: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="20" height="20"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>',
                cloudsun: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="20" height="20"><path d="M12 2v2"/><path d="M4.93 4.93l1.41 1.41"/><path d="M20 12h2"/><path d="M19.07 4.93l-1.41 1.41"/><path d="M15.947 12.65a4 4 0 10-6.094 4.889"/><path d="M13 22H7a5 5 0 114.9-6H13a3 3 0 010 6z"/></svg>',
                moon: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="20" height="20"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>',
                sleep: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="20" height="20"><path d="M2 4v16c0 1.1.9 2 2 2h16"/><path d="M8 10h.01"/><path d="M16 10h.01"/><path d="M9.5 16a3.5 3.5 0 005 0"/><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>'
            };

            // Greeting
            const hour = new Date().getHours();
            let greetingText = 'أهلاً بك';
            let greetingIcon = greetingIcons.wave;
            let iconColor = 'var(--primary)';

            if (hour >= 5 && hour < 12) {
                greetingText = 'صباح الخير';
                greetingIcon = greetingIcons.sun;
                iconColor = 'var(--warning)';
            } else if (hour >= 12 && hour < 17) {
                greetingText = 'طاب يومك';
                greetingIcon = greetingIcons.cloudsun;
                iconColor = 'var(--warning)';
            } else if (hour >= 17 && hour < 22) {
                greetingText = 'مساء الخير';
                greetingIcon = greetingIcons.moon;
                iconColor = 'var(--primary-light)';
            } else {
                greetingText = 'تصبح على خير';
                greetingIcon = greetingIcons.sleep;
                iconColor = 'var(--text-secondary)';
            }

            const greetingEl = document.getElementById('home-greeting');
            if (greetingEl && profile && profile.personal) {
                greetingEl.innerHTML = `
                    <div style="font-size:18px; font-weight:700;">${greetingText} <span class="inline-icon" style="color:${iconColor};">${greetingIcon}</span>، ${profile.personal.name}</div>
                    <div style="font-size:13px; font-weight:400; opacity:0.8; margin-top:4px; line-height:1.4;">بيني وبينك: ${getDailyQuote()}</div>
                 `;
            }

            // Show floating motivation once per session
            if (!sessionStorage.getItem('motivation_shown')) {
                setTimeout(() => {
                    showFloatingMotivation();
                    sessionStorage.setItem('motivation_shown', 'true');
                }, 1500);
            }

            // BMI Display
            const weight = profile.personal.weight;
            const heightCm = profile.personal.height;
            const heightM = heightCm / 100;
            const bmi = (weight / (heightM * heightM)).toFixed(1);

            const bmiValue = document.getElementById('bmi-value');
            if (bmiValue) bmiValue.textContent = bmi;

            // Load Today's Data
            const today = getLogicalDate();
            let todayData = loadData('daily_' + today);

            // If new day, init proper structure if missing
            if (!todayData) {
                initializeTodayData();
                todayData = loadData('daily_' + today);
            }

            // Energy
            const target = profile.calculations.targetCalories;
            const consumed = todayData.totalCalories || 0;
            const remaining = target - consumed;

            const elRemaining = document.getElementById('energy-remaining');
            const elTotal = document.getElementById('energy-total');
            if (elRemaining) elRemaining.textContent = remaining;
            if (elTotal) elTotal.textContent = target;

            // Status Badge & Text
            const statusBadge = document.getElementById('status-badge');
            const statusText = document.getElementById('status-text');

            if (statusBadge && statusText) {
                const percentageRemaining = (remaining / target) * 100;

                // Reset classes
                statusBadge.className = 'status-badge';

                if (remaining < 0) {
                    statusBadge.textContent = 'تجاوزت الحد';
                    statusBadge.classList.add('attention');
                    statusBadge.style.color = 'var(--danger)';
                    statusBadge.style.background = 'rgba(255, 107, 107, 0.1)';
                    statusText.innerHTML = 'لا تقلق، غداً يوم جديد! <br>حاول تخفيف العشاء أو المشي قليلاً.';
                } else if (remaining === 0 || percentageRemaining < 5) {
                    statusBadge.textContent = 'هدف مثالي';
                    statusBadge.classList.add('good');
                    statusBadge.style.color = 'var(--accent)';
                    statusBadge.style.background = 'rgba(0, 217, 165, 0.1)';
                    statusText.textContent = 'أحسنت! لقد حققت هدفك اليومي بدقة عالية.';
                } else if (percentageRemaining < 20) {
                    statusBadge.textContent = 'اقتربت';
                    statusBadge.classList.add('attention');
                    statusText.textContent = 'بقي القليل! اختر وجبة خفيفة غنية بالبروتين لتكملة يومك.';
                } else if (percentageRemaining > 80 && new Date().getHours() > 20) {
                    // Late at night and strict diet?
                    statusBadge.textContent = 'منخفض جداً';
                    statusBadge.classList.add('attention');
                    statusText.textContent = 'سعراتك قليلة اليوم. لا تنسَ تغذية جسمك للتعافي أثناء النوم.';
                } else {
                    statusBadge.textContent = 'في المسار الصحيح';
                    statusBadge.classList.add('good');
                    statusText.textContent = 'لديك مساحة جيدة لتناول وجباتك. استمتع بطعام صحي ومتوازن.';
                }
            }

            // Water
            const waterTargetCups = Math.ceil(profile.calculations.waterIntake / 250); // assuming 250ml cup
            const currentCups = todayData.waterCups || 0;
            const elWaterBadge = document.getElementById('water-count-badge');
            if (elWaterBadge) elWaterBadge.textContent = `${currentCups} / ${waterTargetCups} كوب`;

            const cupsContainer = document.getElementById('water-cups-container');
            if (cupsContainer) {
                cupsContainer.innerHTML = '';
                // Show max 8 cups visually or stick to target
                const cupsToShow = Math.max(waterTargetCups, 8);
                for (let i = 0; i < cupsToShow; i++) {
                    const cup = document.createElement('div');
                    cup.className = `cup-icon icon ${i < currentCups ? 'filled' : ''}`;
                    cup.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2.69l5.66 5.66a8 8 0 11-11.31 0z"/></svg>`;
                    if (i < currentCups) {
                        // Filled style handled by CSS class but ensure fill is visible
                        cup.querySelector('svg').setAttribute('fill', 'currentColor');
                    }
                    cupsContainer.appendChild(cup);
                }

                // Water progress is updated above
                // Water progress is updated above
            }

            // Health Status Badge
            const currentBmi = parseFloat(profile.personal.bmi);
            const gender = profile.personal.gender;
            const healthStatus = getBMIStatus(currentBmi, gender);
            const elBmiBadge = document.getElementById('bmi-status-badge');
            if (elBmiBadge) {
                elBmiBadge.textContent = healthStatus.label;
                elBmiBadge.style.color = healthStatus.color;
                elBmiBadge.style.background = healthStatus.color + '22';
                elBmiBadge.style.borderColor = healthStatus.color + '44';
                elBmiBadge.classList.remove('hidden');
            }

            // Tip Card (60-day rotation)
            const elTip = document.getElementById('daily-tip');
            if (elTip) elTip.textContent = getDailyTip();
        }

        function getBMIStatus(bmi, gender) {
            if (bmi < 18.5) return { label: 'نقص وزن', color: '#FFB347' };
            if (bmi < 24.9) return { label: 'وزن مثالي', color: '#00D9A5' };
            if (bmi < 29.9) return { label: 'زيادة وزن', color: '#FFB347' };
            if (bmi < 34.9) return { label: 'سمنة درجة 1', color: '#FF6B6B' };
            if (bmi < 39.9) return { label: 'سمنة درجة 2', color: '#FF6B6B' };
            return { label: 'سمنة مفرطة', color: '#8B0000' };
        }

        function addWater(amount = 250) {
            const today = getLogicalDate();
            let todayData = loadData('daily_' + today);
            if (!todayData) {
                initializeTodayData();
                todayData = loadData('daily_' + today);
            }

            todayData.water = Math.max(0, (todayData.water || 0) + amount);
            todayData.waterCups = Math.floor(todayData.water / 250);

            saveData('daily_' + today, todayData);
            updateHome();
            updateWaterPage();

            if (amount > 0) showToast('صحة وعافية!');
        }

        function updateWaterPage() {
            const profile = loadData('user_profile');
            const today = getLogicalDate();
            const todayData = loadData('daily_' + today);
            if (!profile || !todayData) return;

            const target = profile.calculations.waterIntake || 2000;
            const current = todayData.water || 0;
            const progress = (current / target) * 100;

            const elText = document.getElementById('water-status-text');
            const elVisual = document.getElementById('water-progress-visual');

            if (elText) elText.textContent = `${current} / ${target} مل`;

            // Water level SVG icons
            const waterIcons = {
                full: '<svg viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="1" width="60" height="60"><path d="M12 2.69l5.66 5.66a8 8 0 11-11.31 0z"/><path d="M2 16s3-2 5 0 5 0 7 0 5-2 8 0" fill="none" stroke-width="2"/></svg>',
                high: '<svg viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="1" width="60" height="60"><path d="M12 2.69l5.66 5.66a8 8 0 11-11.31 0z" opacity="0.9"/></svg>',
                medium: '<svg viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="1" width="60" height="60"><path d="M12 2.69l5.66 5.66a8 8 0 11-11.31 0z" opacity="0.6"/></svg>',
                low: '<svg viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="1" width="60" height="60"><path d="M12 2.69l5.66 5.66a8 8 0 11-11.31 0z" opacity="0.3"/></svg>',
                empty: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="60" height="60"><path d="M12 2.69l5.66 5.66a8 8 0 11-11.31 0z"/><line x1="8" y1="8" x2="16" y2="16"/><line x1="16" y1="8" x2="8" y2="16"/></svg>'
            };

            if (elVisual) {
                if (progress >= 100) elVisual.innerHTML = waterIcons.full;
                else if (progress >= 75) elVisual.innerHTML = waterIcons.high;
                else if (progress >= 50) elVisual.innerHTML = waterIcons.medium;
                else if (progress >= 25) elVisual.innerHTML = waterIcons.low;
                else elVisual.innerHTML = waterIcons.empty;
            }
        }

        // Modal Logic
        function showEnergyExplanation() {
    const modal = document.getElementById('info-modal');
    const title = document.getElementById('modal-title');
    const content = document.getElementById('modal-content');

    if (!modal) return;

    if (title) {
        title.textContent = 'ما معنى الطاقة المتبقية؟';
    }

    if (content) {
        content.textContent =
            'هذا الرقم يمثل "ميزانيتك" من السعرات لهذا اليوم. كلما أكلت ينقص هذا الرقم.';
    }

    // إغلاق قسري حقيقي
    modal.style.display = 'none';
    modal.classList.remove('active');

    // فتح جديد حقيقي
    setTimeout(() => {
        modal.style.display = 'flex';
        modal.classList.add('active');
    }, 10);
}

        function closeModal(e) {
    if (e) e.stopPropagation();

    const modal = document.getElementById('info-modal');
    if (!modal) return;

    modal.classList.remove('active');
    modal.style.display = 'none';

    const overlay = document.querySelector('.modal-overlay');
    if (overlay) overlay.remove();
}

        function showQuickCalculator() {
            // Redirect to Master Calculator for unified professional experience
            showPage('page-calculator');
            switchCalcTab('calc');

            // Optional: Smooth scroll to form
            document.querySelector('#page-calculator .setup-card')?.scrollIntoView({ behavior: 'smooth' });
        }

        let qcCurrentTab = 'adult';
        // switchThemeTab and runQuickCalc removed as homepage now redirects to Master Calculator

        /* ══════════════════════════════════════════
           Statistics & Charts Logic
        ══════════════════════════════════════════ */
        function updateStatisticsPage() {
            const profile = loadData('user_profile');
            const targetCal = (profile && profile.calculations && profile.calculations.targetCalories) || 2000;
            const targetWater = (profile && profile.calculations && profile.calculations.waterIntake) || 2000;

            const history = [];
            let totalCal = 0, totalWater = 0, totalP = 0, totalC = 0, totalF = 0;
            let prevTotalCal = 0, prevTotalWater = 0;
            let daysWithData = 0, prevDaysWithData = 0;
            let complianceCount = 0;

            // Get last 14 days for comparison
            for (let i = 0; i < 14; i++) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateKey = date.toISOString().split('T')[0];
                const dayData = loadData('daily_' + dateKey);

                if (i < 7) {
                    // Current Week
                    if (dayData) {
                        const dayObj = {
                            date: dateKey,
                            dayName: i === 0 ? 'اليوم' : date.toLocaleDateString('ar-EG', { weekday: 'short' }),
                            calories: dayData.totalCalories || 0,
                            water: dayData.water || 0,
                            p: dayData.totalProtein || 0,
                            c: dayData.totalCarbs || 0,
                            f: dayData.totalFat || 0
                        };
                        history.push(dayObj);
                        totalCal += dayObj.calories;
                        totalWater += dayObj.water;
                        totalP += dayObj.p; totalC += dayObj.c; totalF += dayObj.f;
                        daysWithData++;

                        const isCompliant = dayObj.calories > 0 && Math.abs(dayObj.calories - targetCal) <= (targetCal * 0.15);
                        if (isCompliant) complianceCount++;
                    } else {
                        history.push({ dayName: date.toLocaleDateString('ar-EG', { weekday: 'short' }), calories: 0, water: 0, p: 0, c: 0, f: 0 });
                    }
                } else {
                    // Previous Week
                    if (dayData) {
                        prevTotalCal += (dayData.totalCalories || 0);
                        prevTotalWater += (dayData.water || 0);
                        prevDaysWithData++;
                    }
                }
            }

            // Averages
            const avgCal = daysWithData > 0 ? Math.round(totalCal / daysWithData) : 0;
            const avgWater = daysWithData > 0 ? Math.round(totalWater / daysWithData) : 0;
            const prevAvgCal = prevDaysWithData > 0 ? Math.round(prevTotalCal / prevDaysWithData) : 0;
            const prevAvgWater = prevDaysWithData > 0 ? Math.round(prevTotalWater / prevDaysWithData) : 0;

            document.getElementById('stat-avg-cal').textContent = avgCal;
            document.getElementById('stat-avg-water').textContent = (avgWater / 1000).toFixed(1) + ' لتر';

            // Trend Labels
            const calDiffEl = document.getElementById('stat-cal-diff');
            if (prevAvgCal > 0) {
                const perc = Math.round(((avgCal - prevAvgCal) / prevAvgCal) * 100);
                calDiffEl.textContent = `${perc > 0 ? '▲' : '▼'} ${Math.abs(perc)}% عن الأسبوع الماضي`;
                calDiffEl.style.color = (perc > 0 && profile.personal.goal === 'lose') ? 'var(--danger)' : 'var(--accent)';
            } else {
                calDiffEl.textContent = `مقارنة بالهدف: ${avgCal - targetCal}`;
            }

            const waterDiffEl = document.getElementById('stat-water-diff');
            if (prevAvgWater > 0) {
                const perc = Math.round(((avgWater - prevAvgWater) / prevAvgWater) * 100);
                waterDiffEl.textContent = `${perc > 0 ? '▲' : '▼'} ${Math.abs(perc)}% في الترطيب`;
                waterDiffEl.style.color = perc >= 0 ? 'var(--accent)' : 'var(--warning)';
            } else {
                waterDiffEl.textContent = `المكتمل: ${Math.round((avgWater / targetWater) * 100)}%`;
            }

            // Macros %
            const totalMacros = totalP + totalC + totalF || 1;
            const pPerc = Math.round((totalP / totalMacros) * 100);
            const cPerc = Math.round((totalC / totalMacros) * 100);
            const fPerc = 100 - pPerc - cPerc;

            document.getElementById('macro-p-bar').style.width = pPerc + '%';
            document.getElementById('macro-c-bar').style.width = cPerc + '%';
            document.getElementById('macro-f-bar').style.width = fPerc + '%';
            document.getElementById('stat-p-percent').textContent = pPerc + '%';
            document.getElementById('stat-c-percent').textContent = cPerc + '%';
            document.getElementById('stat-f-percent').textContent = fPerc + '%';

            // Compliance UI
            const complianceDaysEl = document.getElementById('compliance-days');
            complianceDaysEl.innerHTML = '';
            [...history].reverse().forEach(day => {
                const dot = document.createElement('div');
                const isCompliant = day.calories > 0 && Math.abs(day.calories - targetCal) <= (targetCal * 0.15);
                dot.style.width = '12px'; dot.style.height = '12px'; dot.style.borderRadius = '50%';
                dot.style.background = isCompliant ? 'var(--accent)' : 'rgba(255,255,255,0.1)';
                complianceDaysEl.appendChild(dot);
            });
            document.getElementById('compliance-text').textContent = `التزمت بأهدافك في ${complianceCount} أيام من آخر 7 أيام.`;

            // Draw Charts
            const chartHistory = [...history].reverse();
            drawBarChart('cal-chart-svg', chartHistory.map(d => d.calories), 'var(--primary)');
            drawBarChart('water-chart-svg', chartHistory.map(d => d.water), '#4facfe');

            // Render Table
            const tableBody = document.getElementById('history-table-body');
            tableBody.innerHTML = history.map(day => `
                <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
                    <td style="padding:15px; font-weight:600;">${day.dayName}</td>
                    <td style="padding:15px; text-align:center;">${day.calories}</td>
                    <td style="padding:15px; text-align:center;">${(day.water / 1000).toFixed(1)}L</td>
                    <td style="padding:15px; text-align:center; opacity:0.7;">${day.p}/${day.c}/${day.f}</td>
                </tr>
            `).join('');
        }

        function drawBarChart(elementId, values, color) {
            const container = document.getElementById(elementId);
            if (!container) return;

            const width = container.clientWidth || 300;
            const height = 180;
            const padding = 30;
            const barSpacing = 12;
            const barWidth = (width - (padding * 2) - (barSpacing * (values.length - 1))) / values.length;
            const maxVal = Math.max(...values, 100) * 1.1; // Add 10% headroom

            let svg = `<svg width="100%" height="100%" viewBox="0 0 ${width} ${height}" preserveAspectRatio="none">
                <defs>
                    <linearGradient id="barGradient-${elementId}" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" style="stop-color:${color}; stop-opacity:1" />
                        <stop offset="100%" style="stop-color:${color}; stop-opacity:0.3" />
                    </linearGradient>
                </defs>
            `;

            // Guidelines
            for (let i = 0; i <= 4; i++) {
                const y = padding + (i * (height - padding * 2) / 4);
                svg += `<line x1="${padding}" y1="${y}" x2="${width - padding}" y2="${y}" stroke="var(--border)" stroke-width="0.5" stroke-dasharray="4" />`;
            }

            values.forEach((v, i) => {
                const barHeight = (v / maxVal) * (height - padding * 2);
                const x = padding + i * (barWidth + barSpacing);
                const y = height - padding - barHeight;

                svg += `
                    <rect x="${x}" y="${y}" width="${barWidth}" height="${barHeight}" rx="6" fill="url(#barGradient-${elementId})">
                        <animate attributeName="height" from="0" to="${barHeight}" dur="0.8s" ease="ease-out" />
                        <animate attributeName="y" from="${height - padding}" to="${y}" dur="0.8s" ease="ease-out" />
                    </rect>
                `;
            });

            // X-Axis Baseline
            svg += `<line x1="${padding}" y1="${height - padding}" x2="${width - padding}" y2="${height - padding}" stroke="var(--border)" stroke-width="1.5" />`;

            svg += `</svg>`;
            container.innerHTML = svg;
        }
        const MEAL_TYPES = {
            breakfast: { label: 'الفطور', iconType: 'sun', desc: 'وجبة تمنحك طاقة الصباح', time: 8 },
            lunch: { label: 'الغداء', iconType: 'utensils', desc: 'وجبة رئيسية تشبعك', time: 14 },
            dinner: { label: 'العشاء', iconType: 'moon', desc: 'وجبة خفيفة لنوم مريح', time: 20 },
            snack: { label: 'سناك', iconType: 'apple', desc: 'تصبيرة صحية', time: 17 }
        };

        const HealthEngine = {
            evaluate: function (food, userConditions) {
                let report = { isSafe: true, warnings: [] };
                const tags = food.tags || {};

                // Check only the user's selected health conditions
                if (userConditions && userConditions.length > 0) {
                    userConditions.forEach(cond => {
                        if (tags[cond]) {
                            report.warnings.push({
                                condition: cond,
                                text: tags[cond].text,
                                level: tags[cond].level
                            });
                            report.isSafe = false;
                        }
                    });
                }

                return report;
            }
        };

        var FOOD_DB = [
            // فطور
            {
                id: 'f1', name: 'بنت الصحن (عصيدة)', cal: 320, p: 8, c: 55, f: 8, cat: 'breakfast',
                image: 'logo.jpg',
                tags: {
                    diabetes: { text: 'قلل الكمية - عسل وسكريات', level: 'danger' },
                    cholesterol: null,
                    blood_pressure: null,
                    heart: null,
                    kidney: null,
                    digestive: null,
                    allergies: null,
                    pregnant: null
                }
            },
            {
                id: 'f2', name: 'شوفان بالحليب', cal: 250, p: 10, c: 45, f: 5, cat: 'breakfast',
                image: 'logo.jpg',
                tags: {
                    diabetes: null,
                    cholesterol: null,
                    blood_pressure: null,
                    heart: null,
                    kidney: null,
                    digestive: { text: 'لطيف على المعدة', level: 'success' },
                    allergies: null,
                    pregnant: null
                }
            },
            {
                id: 'f3', name: 'بيض بالبسطرمة', cal: 280, p: 20, c: 4, f: 20, cat: 'breakfast',
                image: 'logo.jpg',
                tags: {
                    diabetes: null,
                    cholesterol: { text: 'استخدم بياض البيض فقط', level: 'caution' },
                    blood_pressure: { text: 'استبدل البسطرمة بطماطم', level: 'danger' },
                    heart: { text: 'نسبة أملاح عالية', level: 'danger' },
                    kidney: null,
                    digestive: null,
                    allergies: null,
                    pregnant: null
                }
            },
            {
                id: 'f4', name: 'فول مدمس بالكمون', cal: 300, p: 18, c: 40, f: 6, cat: 'breakfast',
                image: 'logo.jpg',
                tags: {
                    diabetes: null,
                    cholesterol: null,
                    blood_pressure: { text: 'اغسل الفول من الماء المحفوظ', level: 'caution' },
                    heart: null,
                    kidney: null,
                    digestive: { text: 'يساعد في الهضم', level: 'success' },
                    allergies: null,
                    pregnant: null
                }
            },
            {
                id: 'f5', name: 'قرص بالسمن', cal: 350, p: 6, c: 50, f: 14, cat: 'breakfast',
                image: 'logo.jpg',
                tags: {
                    diabetes: { text: 'استخدم دقيق بر (أسمر)', level: 'danger' },
                    cholesterol: { text: 'استبدل السمن بزيت زيتون', level: 'danger' },
                    blood_pressure: null,
                    heart: { text: 'دهون مشبعة عالية', level: 'danger' },
                    kidney: null,
                    digestive: null,
                    allergies: null,
                    pregnant: null
                }
            },

            // غداء
            {
                id: 'f6', name: 'سلتة يمنية', cal: 380, p: 22, c: 35, f: 16, cat: 'lunch',
                image: 'logo.jpg',
                tags: {
                    diabetes: null,
                    cholesterol: null,
                    blood_pressure: { text: 'قلل الملح في المرق', level: 'caution' },
                    heart: null,
                    kidney: null,
                    digestive: { text: 'تحتوي على حلبة (مفيدة)', level: 'success' },
                    allergies: null,
                    pregnant: null
                }
            },
            {
                id: 'f7', name: 'مظبي دجاج', cal: 420, p: 35, c: 45, f: 10, cat: 'lunch',
                image: 'logo.jpg',
                tags: {
                    diabetes: null,
                    cholesterol: null,
                    blood_pressure: null,
                    heart: null,
                    kidney: null,
                    digestive: null,
                    allergies: null,
                    pregnant: null
                }
            },
            {
                id: 'f8', name: 'فحسة يمنية', cal: 350, p: 24, c: 28, f: 14, cat: 'lunch',
                image: 'logo.jpg',
                tags: {
                    diabetes: null,
                    cholesterol: { text: 'اختر لحم قليل الدهن', level: 'caution' },
                    blood_pressure: null,
                    heart: null,
                    kidney: null,
                    digestive: null,
                    allergies: null,
                    pregnant: null
                }
            },
            {
                id: 'f9', name: 'صدر دجاج مشوي', cal: 165, p: 31, c: 0, f: 3.6, cat: 'lunch',
                image: 'logo.jpg',
                tags: {
                    diabetes: null,
                    cholesterol: null,
                    blood_pressure: null,
                    heart: null,
                    kidney: null,
                    digestive: null,
                    allergies: null,
                    pregnant: { text: 'مصدر بروتين آمن ونظيف', level: 'success' }
                }
            },
            {
                id: 'f27', name: 'سلطة خضراء', cal: 50, p: 2, c: 10, f: 0, cat: 'lunch',
                image: 'logo.jpg',
                tags: {
                    diabetes: { text: 'خيار ممتاز ومنظم للسكري', level: 'success' },
                    cholesterol: { text: 'تساعد في خفض الكوليسترول', level: 'success' },
                    blood_pressure: null,
                    heart: { text: 'صديقة للقلب', level: 'success' },
                    kidney: null,
                    digestive: { text: 'غنية بالألياف', level: 'success' },
                    allergies: null,
                    pregnant: { text: 'غنية بالفيتامينات', level: 'success' }
                }
            },
            {
                id: 'f10', name: 'كبسة لحم', cal: 450, p: 28, c: 52, f: 14, cat: 'lunch',
                image: 'logo.jpg',
                tags: {
                    diabetes: { text: 'قلل الأرز وزد السلطة', level: 'danger' },
                    cholesterol: { text: 'اختر لحم بدون شحم', level: 'caution' },
                    blood_pressure: null,
                    heart: { text: 'تجنب الإفراط (دهون عالية)', level: 'caution' },
                    kidney: null,
                    digestive: null,
                    allergies: null,
                    pregnant: null
                }
            },

            // عشاء
            {
                id: 'f11', name: 'شفوت يمني', cal: 180, p: 8, c: 28, f: 4, cat: 'dinner',
                image: 'logo.jpg',
                tags: {
                    diabetes: null,
                    cholesterol: null,
                    blood_pressure: null,
                    heart: null,
                    kidney: null,
                    digestive: { text: 'زبادي (مريح للمعدة)', level: 'success' },
                    allergies: null,
                    pregnant: null
                }
            },
            {
                id: 'f12', name: 'عصيدة بالعسل', cal: 290, p: 6, c: 52, f: 7, cat: 'dinner',
                image: 'logo.jpg',
                tags: {
                    diabetes: { text: 'قلل العسل أو استخدم بديل', level: 'danger' },
                    cholesterol: null,
                    blood_pressure: null,
                    heart: null,
                    kidney: null,
                    digestive: null,
                    allergies: null,
                    pregnant: null
                }
            },
            {
                id: 'f13', name: 'شوربة العدس', cal: 150, p: 9, c: 25, f: 1, cat: 'dinner',
                image: 'logo.jpg',
                tags: {
                    diabetes: null,
                    cholesterol: null,
                    blood_pressure: null,
                    heart: { text: 'مفيدة لصحة الشرايين', level: 'success' },
                    kidney: null,
                    digestive: { text: 'سهلة الهضم', level: 'success' },
                    allergies: null,
                    pregnant: { text: 'غنية بالحديد وحمض الفوليك', level: 'success' }
                }
            },
            {
                id: 'f14', name: 'تونة مع خضار', cal: 180, p: 25, c: 5, f: 8, cat: 'dinner',
                image: 'logo.jpg',
                tags: {
                    diabetes: null,
                    cholesterol: { text: 'دهون أوميغا 3 صحية', level: 'success' },
                    blood_pressure: null,
                    heart: { text: 'تحسن وظائف القلب', level: 'success' },
                    kidney: null,
                    digestive: null,
                    allergies: null,
                    pregnant: { text: 'آمنة إذا كانت معلبات خفيفة', level: 'caution' }
                }
            },

            // سناك
            {
                id: 'f26', name: 'شاي عدني (حليب وسكر)', cal: 120, p: 3, c: 18, f: 4, cat: 'snack',
                image: 'logo.jpg',
                tags: {
                    diabetes: { text: 'استخدم سكر دايت وحليب قليل الدسم', level: 'danger' },
                    cholesterol: null,
                    blood_pressure: null,
                    heart: null,
                    kidney: null,
                    digestive: null,
                    allergies: null,
                    pregnant: { text: 'قلل الكافيين في الحمل', level: 'caution' }
                }
            },
            {
                id: 'f23', name: 'مشروب غازي', cal: 140, p: 0, c: 39, f: 0, cat: 'snack',
                image: 'logo.jpg',
                tags: {
                    diabetes: { text: 'استبدله بماء أو عصير طبيعي', level: 'danger' },
                    cholesterol: null,
                    blood_pressure: null,
                    heart: { text: 'يؤثر سلباً على صحة القلب', level: 'danger' },
                    kidney: { text: 'قد يسبب حصوات الكلى', level: 'danger' },
                    digestive: { text: 'يسبب غازات وانتفاخ', level: 'caution' },
                    allergies: null,
                    pregnant: { text: 'مضر جداً بصحة الجنين', level: 'danger' }
                }
            },
            {
                id: 'f21', name: 'برجر لحم', cal: 450, p: 25, c: 30, f: 25, cat: 'lunch',
                image: 'logo.jpg',
                tags: {
                    diabetes: null,
                    cholesterol: { text: 'اختر لحم قليل الدهن', level: 'danger' },
                    blood_pressure: { text: 'قلل الصوصات والملح', level: 'danger' },
                    heart: { text: 'تجنب الإكثار منه', level: 'danger' },
                    kidney: null,
                    digestive: { text: 'وجبة ثقيلة على الهضم', level: 'caution' },
                    allergies: null,
                    pregnant: null
                }
            },
            {
                id: 'f24', name: 'شيبس بطاطس', cal: 350, p: 4, c: 45, f: 18, cat: 'snack',
                image: 'logo.jpg',
                tags: {
                    diabetes: null,
                    cholesterol: { text: 'استبدله ببدائل صحية', level: 'danger' },
                    blood_pressure: { text: 'عالي الملح - تجنبه', level: 'danger' },
                    heart: { text: 'دهون متحولة - تجنبه', level: 'danger' },
                    kidney: { text: 'أملاح عالية جداً', level: 'danger' },
                    digestive: null,
                    allergies: null,
                    pregnant: { text: 'يحتوي على مواد حافظة', level: 'danger' }
                }
            },
            {
                id: 'f25', name: 'حلويات شرقية', cal: 320, p: 3, c: 48, f: 14, cat: 'snack',
                image: 'logo.jpg',
                tags: {
                    diabetes: { text: 'قلل الكمية جداً', level: 'danger' },
                    cholesterol: { text: 'سمن ودهون عالية', level: 'danger' },
                    blood_pressure: null,
                    heart: { text: 'سكر وسمن يضران القلب', level: 'danger' },
                    kidney: null,
                    digestive: null,
                    allergies: null,
                    pregnant: { text: 'سعرات وسكر غير مفيد', level: 'caution' }
                }
            }
        ];

        const APP_COMPANION_PHRASES = [
            "يا {name}، ملامحك اليوم فيها لمعة فخر، والسبب ذكائك في اختيار صحتك!",
            "أهلًا بسيد القلب {name}، وجودك ينور التطبيق ويخليني أتحمس لمساعدتك.",
            "يا {name}، تدري إنك ملهم؟ كل اختيار صحي تسويه اليوم هو قصة نجاح بكره.",
            "إطلالتك اليوم غير يا {name}، شكلك بدأ يبهر حتى الأرقام اللي عندي!",
            "يا {name}، تراك غالي علينا، وصحتك هي أمانتي اللي بكمل فيها معاك.",
            "يسعد صباحك يا {name}، يوم جديد نكتب فيه فصل جديد من جمالك وصحتك.",
            "يا {name}، أنا فخور فيك، مو بس لأنك ملتزم، لأنك شخص يحب نفسه بصدق.",
            "يا رفيق دربي {name}، الصحة تليق بك حقاً، لا تفرط في هذا الجمال.",
            "يا {name}، كل وجبة تاكلها بذكاء هي رسالة حب لقلبك الطيب.",
            "تعجبني روحك القوية يا {name}، هذي العزيمة هي اللي بتوصلنا للقمة.",
            "يا {name}، ابتسم.. جسمك جالس يشكرك دحين على كل قطرة موية شربتها.",
            "أنت مو بس مستخدم يا {name}، أنت شريك نجاح وصديق أفتخر فيه.",
            "يا {name}، كل جرام تنزله أو عضلة تطلعها هي شهادة ذكاء لك.",
            "يا مذهل {name}، استمر.. العالم ينتظر يشوف نسختك الأجمل.",
            "يا {name}، أنا هنا عشان أذكرك إنك تستحق كل خير وصحة وجمال.",
            "يا {name}، خذ نفس عميق وتذكر إنك بطل في عيوني دايمًا.",
            "يا {name}، جمالك الداخلي صار ينعكس على نظامك الغذائي، تبارك الله!",
            "يا {name}، حضورك يعطي يومي معنى، شكراً لأنك مهتم بنفسك.",
            "يا {name}، أنت جوهرة لازم نحافظ عليها، وأنا هنا عشان أصقل هذي الجوهرة.",
            "يا {name}، كل تضحية بسيطة دحين هي فرحة كبيرة قدام، كمل يا بطل.",
            "يا {name}، طاب يومك بجمال روحك وطعم اختياراتك الصحية.",
            "يا {name}، أنت تشبه الصبح في إشراقه، خلك دايمًا كذا مشرق بصحتك.",
            "يا {name}، تدري إنك قد اللقا؟ وزي ما بدينا بقوة بنكمل بإبداع.",
            "يا {name}، يا زينك وأنت تهتم بأصغر التفاصيل، أنت فعلًا مميز.",
            "يا {name}، عيونك فيها بريق إرادة ما ينطفي، أنا معاك للنهاية.",
            "يا {name}، تذكر إنك سيد قراراتك، وقرارك اليوم هو الصحة والسعادة.",
            "يا {name}، ما فيه شي يصعب عليك، الإرادة اللي عندك تهز جبال.",
            "يا {name}، أنت تبني مستقبلك بكل لقمة، خلك دايمًا مهندس شاطر.",
            "يا {name}، الراحة تليق بك، خذ قسط كافي من النوم يا رفيقي.",
            "يا {name}، أنت شمسنا اللي ما تغيب، خلك دايمًا بصحة وعافية.",
            "يا {name}، كل خطوة تخطيها هي لحن جميل في سيمفونية حياتك.",
            "يا {name}، أنت تستحق الدلال، وصحة جسمك هي أكبر دلال.",
            "يا {name}، فخور بصبرك، الصبر هو مفتاح كل النتائج اللي تحلم بها.",
            "يا {name}، يا بطل الحكاية، كمل المشوار ونحن جنبك بكل خطوة.",
            "يا {name}، ذوقك في الأكل صار أرقى، وصحتك صارت أغلى.",
            "يا {name}، أنت تملك كاريزما الوعي، وهذا سر جاذبيتك الحقيقي.",
            "يا {name}، خلك دايم واثق إن بكرة أحلى بفضل عملك اليوم.",
            "يا {name}، أنت قائد رحلتك، وأنا مساعدك الوفي، وين بنروح اليوم؟",
            "يا {name}، قلبك يستاهل عناية، وأنت كفيت ووفيت اليوم.",
            "يا {name}، أنت شعلة أمل لكل اللي حولك، لا تطفئها أبدًا.",
            "يا {name}، روعة إنجازك اليوم خليني أقول: ما شاء الله عليك!",
            "يا {name}، الجمال مو بس بالشكل، الجمال في روحك اللي تهتم بالصحة.",
            "يا {name}، أنت تستاهل تكون في أحسن حال، وأنا هنا عشان كذا.",
            "يا {name}، خليك حنين على نفسك، الزلات بسيطة والهدف كبير.",
            "يا {name}، أنت كنز حقيقي، وصحتك هي الذهب اللي يلمع فيك.",
            "يا {name}، يا أجمل صديق، رحلتنا مع بعض هي أحلى شي صار لي.",
            "يا {name}، روحك الرياضية هي اللي بتخليك دايمًا شاب وجميل.",
            "يا {name}، أنت فنان في اختيار الأفضل لجسدك، استمر في الإبداع.",
            "يا {name}، تذكر إنك نجم، والنجم دايمًا يحافظ على نوره.",
            "يا {name}، حضورك يبهج القلب، واهتمامك بنفسك يبهج الروح.",
            "يا {name}، أنت شجاع كفاية عشان تختار الطريق الصحيح، كمل!",
            "يا {name}، يا ملهم العصور، خطواتك ثابتة وهدفك واضح.",
            "يا {name}، كل يوم معاك هو تجربة جديدة في حب الذات والاهتمام.",
            "يا {name}، أنت تملك مفاتيح السعادة، وبديت تفتح أبوابها بصحتك.",
            "يا {name}، عافيتك هي رأس مالك، وأنت مستثمر ناجح جدًا.",
            "يا {name}، يا نبض القلب، خلك دايمًا قوي ومتمسك بأهدافك.",
            "يا {name}، الابتسامة تليق بوجهك المشرق بالصحة، لا تغيبها.",
            "يا {name}، أنت تخلي العادات الصحية تبدو كأنها لعبة ممتعة.",
            "يا {name}، يا صاحب الهمة العالية، القمة تناديك، قربنا نصل.",
            "يا {name}، أنت فعلًا ذكي، عرفت كيف توازن بين المتعة والصحة.",
            "يا {name}، تراك غالي، لا تقسي على حالك، التوازن هو السر.",
            "يا {name}، حضورك الطاغي يخلي الأرقام عندي تبتسم لك!",
            "يا {name}، أنت شخص استثنائي، وما يرضيك إلا الإنجاز الاستثنائي.",
            "يا {name}، خليك دايمًا فخور باللي حققته، الرحلة ممتعة بوجودك.",
            "يا {name}، أنت تبني قصراً من العافية، وكل طوبة هي خيار صحي.",
            "يا {name}، يا روح المكان، أنت تجعل الصحة تبدو جذابة وساحرة.",
            "يا {name}، خلك دايمًا واثق إنك تستحق الأفضل في كل شي.",
            "يا {name}، أنت علمتني إن الإرادة أقوى من أي مغريات.",
            "يا {name}، يا رفيق الإنجاز، اليوم كان يومك بامتياز، أحسنت.",
            "يا {name}، أنت تزداد جمالاً وإشراقاً مع كل قرار واعي تتخذه.",
            "يا {name}، أنت لست رقماً في التطبيق، أنت بطل في قلبي.",
            "يا {name}، الحياة أجمل وأنت خفيف ونشيط، استمر في تألقك.",
            "يا {name}، أنت كالنور في عتمة الكسل، تشرق دايمًا بالنشاط.",
            "يا {name}، عيونك تحكي قصة إصرار خرافية، أنا فخور فيك.",
            "يا {name}، تذكر إنك تستحق أن تعيش حياة مليئة بالصحة والحيوية.",
            "يا {name}، أنت تجعل من كل تحدي فرصة عشان تثبت قوتك.",
            "يا {name}، يا سيد العارفين بالجمال، صحتك هي أساس هذا الجمال.",
            "يا {name}، عافيتك تزيّنك، واهتمامك يزيدك وقار وجاذبية.",
            "يا {name}، أنت ترسم طريقًا جديدًا لكل اللي يحبونك، خلك قدوة.",
            "يا {name}، يا أيها الشامخ بطموحك، لا تنظر للخلف، بكرة أجمل.",
            "يا {name}، أنت تملك سحراً خاصاً، وهو سحر الانضباط والوعي.",
            "يا {name}، يا صديقي الوفي، أنا هنا دايمًا عشان أسندك ونكمل.",
            "يا {name}، كل مرة تفتح التطبيق، أحس إننا خطينا خطوة للمستقبل.",
            "يا {name}، طاقتك الإيجابية معدية، شكراً لأنك تنشرها بصحتك.",
            "يا {name}، عجزت الكلمات توصف فخري فيك، أنت أسطورة حقيقية.",
            "يا {name}، يا ريحانة القلب، الصحة هي عطرك الحقيقي، حافظ عليه.",
            "يا {name}، أنت ذكي كالعادة، تختار اللي يفيدك ويمتعك في نفس الوقت.",
            "يا {name}، الروتين الصحي معاك يصير رحلة استكشاف ممتعة.",
            "يا {name}، يا منبع الأمل، استمر في نشر ضوئك من خلال صحتك.",
            "يا {name}، أنت تبهرني في كل مرة تختار فيها البديل الصحي بذكاء.",
            "يا {name}، أنت ملك في مملكة صحتك، وقراراتك هي اللي تبنيها.",
            "يا {name}، يا قصة ملهمة، العالم يحتاج يعرف سر إرادتك.",
            "يا {name}، أنت تخلي كل شي صعب يبان سهل بابتسامتك ووعيك.",
            "يا {name}، صحتك هي اللغة اللي يعبر بها جسمك عن حبه لك.",
            "يا {name}، يا زهرة العمر، حافظي على نضارتك باختياراتك الذكية.",
            "يا {name}، أنت تمتلك قلباً من ذهب، حافظ عليه بالرياضة والغذاء.",
            "يا {name}، يا أيها المبدع في فن الحياة، صحتك هي لوحتك الأجمل.",
            "يا {name}، عجزت الأرقام عن وصف روعة التزامك، أنت قمة!",
            "يا {name}، خليك دايمًا متفائل، التغيير قادم بجمال يليق بك.",
            "يا {name}، أنت تملك كنز القناعة والوعي، وهذا أكبر ثروة.",
            "يا {name}، يا رفيق الدرب، حضورك يخلي كل وجبة صحية لها طعم ألذ.",
            "يا {name}، أنت تشبه النجم الساطع، كلما اهتميت بصحتك زاد نورك.",
            "يا {name}، فخور بقدرتك على تجاوز الصعاب، أنت بطل حقيقي.",
            "يا {name}، يا سيد الأناقة والجمال، جسمك الصحي هو أجمل لبس تلبسه.",
            "يا {name}، أنت تملك إرادة من حديد وقلب من رقة، توازن مذهل!",
            "يا {name}، يا منبع النور، خلك دايمًا مصدر إلهام لنا جميعًا.",
            "يا {name}، خلك واثق إن تعبك اليوم هو راحة وسعادة لبكرة.",
            "يا {name}، أنت تبني جسوراً من العافية لكل أهلك وأحبائك.",
            "يا {name}، يا أيها الحكيم، اخترت الطريق الصعب لأنه الطريق الصح.",
            "يا {name}، أنت تملك سحر الإنجاز في عيونك، لا تتراجع أبدًا.",
            "يا {name}، يا رفيقي الغالي، رحلتنا مع بعض تزيدك جمال وتزيدني فخر.",
            "يا {name}، أنت تجعل الالتزام يبدو فنياً وراقياً جداً.",
            "يا {name}، يا شعلة لا تنطفئ، استمر في إضاءة دربك بالوعي.",
            "يا {name}، عافيتك هي التاج اللي تلمعه كل يوم باهتمامك.",
            "يا {name}، أنت فنان في هندسة حياتك الجديدة، استمر في البناء.",
            "يا {name}، يا أجمل حكاية، كمل المشوار ونحن ننتظر النهاية السعيدة.",
            "يا {name}، ذكاؤك في اختيار أكلك يخليني أتعلم منك كل يوم.",
            "يا {name}، أنت تملك روحاً طموحة، وما يرضيك إلا القمة في كل شي.",
            "يا {name}، تعجبني ثقتك بنفسك، وهي اللي بتوصلك لكل اللي تبيه.",
            "يا {name}، يا رفيق الوعي، أنت تخلي الحياة الصحية أسلوب حياة ممتع.",
            "يا {name}، أنت تزداد تألقاً كلما زاد اهتمامك بصحتك النفسية.",
            "يا {name}، يا منبع الطاقة، خلك دايمًا مشحون بالأمل والنشاط.",
            "يا {name}، أنت تصنع معجزات صغيرة كل يوم بعاداتك البسيطة.",
            "يا {name}، يا أغلى ما نملك، صحتك هي الأمانة اللي نصونها سوا.",
            "يا {name}، فخور بكوني جزء من يومك، أنت شخص مميز جداً.",
            "يا {name}، أنت قائد حكيم لنفسك، استمر في قيادتنا نحو الأفضل.",
            "يا {name}، خلك دايمًا مبتسم للدنيا، وصحتك هي اللي بتخليها تبتسم لك.",
            "يا {name}، أنت تملك بصمة صحية فريدة، لا تشبه أحد غيرك.",
            "يا {name}، يا ريحانة الروح، عطرك هو الصحة وعنفوانك هو الالتزام.",
            "يا {name}، أنت تبني إرثاً من الصحة لأجيالك القادمة بكل فخر.",
            "يا {name}، يا أيها المقاتل الشجاع، هزمنا الكسل واليوم ننتصر.",
            "يا {name}، أنت تملك كاريزما الوعي التي تسحر كل من يراك.",
            "يا {name}، خلك دايم ممتن لقوتك اللي وصلتك لهذي المرحلة العظيمة.",
            "يا {name}، يا سيد العارفين بالجمال، عافيتك هي سر إشراقك الدائم.",
            "يا {name}، أنت تزداد وقاراً وجاذبية مع كل خطوة تخطيها بوعي.",
            "يا {name}، يا ملهمي الأول، رحلتك هي مصدر فخري الدائم فيك.",
            "يا {name}، أنت تملك القدرة على تغيير قدرك بإرادتك القوية.",
            "يا {name}، خلك دايم واثق إنك تستحق أجمل نسخة من حالك.",
            "يا {name}، يا رفيقي المخلص، أنا هنا دايم حارس لصحتك وأمانيك.",
            "يا {name}، كل يوم يمر معاك أحس إننا صرنا أقرب من أحلامنا.",
            "يا {name}، أنت تملك روحاً لا تشيخ أبداً، والسر هو وعيك ونشاطك.",
            "يا {name}، يا منبع الضياء، خلك دايمًا مصدر إلهام ونور للي حولك.",
            "يا {name}، أنت تخلي الالتزام الصحي يبدو كأنه رحلة ملكية فخمة.",
            "يا {name}، تعجبني دقة ملاحظتك وصبرك الجميل، أنت إنسان راقي.",
            "يا {name}، يا أيها الطموح، القمة تليق بك، كمل ولا تلتفت.",
            "يا {name}، أنت ملك في مملكتك، وصحتك هي التاج اللي لبسك إياه.",
            "يا {name}، يا رفيق العمر، رحلتنا مكملة بجمال روحك وقوة عزيمتك.",
            "يا {name}، أنت شمس تشرق بالأمل في كل مرة تهتم فيها بنفسك.",
            "يا {name}، يا صاحبي الغالي، نوم الهنا وصحة العافية دايمًا يارب.",
            "يا {name}، أنت فخور بنفسك، وأنا أفخر فيك أكثر، استمر يا بطل!"
        ];

        let dailyQuote = null;

        function getDailyQuote() {
            if (dailyQuote) return dailyQuote;

            const profile = loadData('user_profile');
            const name = (profile && profile.personal && profile.personal.name) || 'صديقي';

            const idx = Math.floor(Math.random() * APP_COMPANION_PHRASES.length);
            const template = APP_COMPANION_PHRASES[idx];

            dailyQuote = template.replace(/{name}/g, name);
            return dailyQuote;
        }

        /* ══════════════════════════════════════════
           Daily Health Advice Rotation (60 Days)
        ══════════════════════════════════════════ */
        const DAILY_HEALTH_TIPS = [
            "اشرب كوباً من الماء فور استيقاظك لتنشيط أعضائك الداخلية.",
            "المشي لمدة 30 دقيقة يومياً يقلل من خطر الإصابة بأمراض القلب بشكل كبير.",
            "استبدل السكر الأبيض بالعسل الطبيعي أو الفواكه للتحلية.",
            "النوم الكافي (7-8 ساعات) ضروري جداً لتوازن هرمونات الجوع والشبع.",
            "اجعل نصف طبقك دائماً من الخضروات الورقية والملونة.",
            "تناول البروتين في كل وجبة يساعد على الشعور بالشبع لفترة أطول.",
            "قلل من تناول الأملاح لتجنب احتباس السوائل وارتفاع ضغط الدم.",
            "الألياف الموجودة في الشوفان والحبوب الكاملة تحسن عملية الهضم.",
            "الشاي الأخضر يحتوي على مضادات أكسدة قوية تعزز عملية التمثيل الغذائي.",
            "تجنب تناول الطعام قبل النوم بـ 3 ساعات على الأقل.",
            "المكسرات النيئة (اللوز، الجوز) مصدر ممتاز للدهون الصحية والبروتين.",
            "ابتعد عن المشروبات الغازية واستبدلها بالعصائر الطبيعية المخففة.",
            "ممارسة تمارين التمدد صباحاً تحسن مرونة الجسم والدورة الدموية.",
            "تناول الطعام ببطء وامضغ جيداً لتسهيل عملية الهضم والامتصاص.",
            "التعرض لأشعة الشمس لمدة 15 دقيقة يومياً يزودك بفيتامين د الضروري.",
            "تجنب الجلوس الطويل؛ تحرك لمدة 5 دقائق كل ساعة.",
            "الزبادي يحتوي على بكتيريا نافعة (البروبيوتيك) تعزز صحة الأمعاء.",
            "حافظ على وزنك المثالي للوقاية من آلام المفاصل والظهر.",
            "قلل من تناول الأطعمة المقلية واستخدم الشواء أو الطبخ بالبخار.",
            "الفواكه الحمراء (الفراولة، التوت) تعزز المناعة بفضل فيتامين سي.",
            "التنفس العميق والمدفوع يقلل من مستويات التوتر والكورتيزول.",
            "استخدم زيت الزيتون البكر للصحة العامة وصحة القلب.",
            "تناول الأسماك مرتين أسبوعياً يزودك بأوميغا 3 الضروري للدماغ.",
            "تجنب الأطعمة المصنعة والمعلبة قدر الإمكان لاحتوائها على مواد حافظة.",
            "البقوليات (العدس، الفول) مصدر نباتي رائع للبروتين والألياف.",
            "اشرب الماء قبل الوجبات بـ 30 دقيقة للمساعدة في التحكم بالشهية.",
            "البيض المسلوق خيار مثالي لفطور صحي وغني بالبروتين.",
            "الكركم يحتوي على مادة الكركمين التي تعالج الالتهابات بشكل طبيعي.",
            "تجنب الضغط النفسي؛ مارس هواية تحبها لتفريغ الطاقة السلبية.",
            "العصائر الخضراء وسيلة ممتازة لتطهير الجسم من السموم.",
            "قلل من الكافيين في المساء لضمان جودة نوم أفضل.",
            "التفاح يقلل من الكوليسترول الضار في الدم.",
            "الثوم يعمل كمضاد حيوي طبيعي ويعزز صحة جهازك المناعي.",
            "الثبات على مواعيد الوجبات ينظم عمل الساعة البيولوجية للجسم.",
            "القرفة تساعد في تنظيم مستويات السكر في الدم.",
            "السبانخ والجرجير يزودان الجسم بالحديد وحمض الفوليك.",
            "تجنب السهر الطويل لأنه يزيد من الرغبة في تناول الأطعمة السكرية.",
            "الموز مصدر ممتاز للبوتاسيوم الذي ينظم ضغط الدم.",
            "الجزر يقوي النظر ويحمي البشرة بفضل البيتا كاروتين.",
            "التمارين الرياضية تحسن الحالة المزاجية بسبب إفراز الإندورفين.",
            "البطاطا الحلوة خيار كربوهيدرات معقدة أفضل من البطاطس البيضاء.",
            "استخدم أطباقاً أصغر حجماً للتحكم في كمية الطعام المستهلكة.",
            "الكاكاو الخام يحسن صحة القلب ويخفض ضغط الدم.",
            "الماء والليمون صباحاً يساعدان في تحسين عملية الهضم.",
            "الأفوكادو يحسن امتصاص الفيتامينات الذائبة في الدهون.",
            "البذور (بذور الكتان، الشيا) تضيف قيمة غذائية عالية لوجباتك.",
            "تجنب الوجبات السريعة التي تحتوي على دهون متحولة ضارة.",
            "البروكلي من أفضل الخضروات المقاومة للأمراض المزمنة.",
            "التأمل يومياً لمدة 10 دقائق يحسن التركيز وهدوء الأعصاب.",
            "احرص على تنوع ألوان الخضروات في طبقك (مبدأ قوس قزح).",
            "البطيخ يرطب الجسم ويحميه من الجفاف في الصيف.",
            "الحليب قليل الدسم أو بدائل الحليب مصدر جيد للكالسيوم.",
            "التقليل من النشويات البيضاء يعزز خسارة الوزن الزائد.",
            "القهوة السوداء باعتدال تعزز التركيز وحرق الدهون.",
            "شوربة الخضار وجبة خفيفة ومغذية وسهلة الهضم.",
            "العسل الأبيض يقوي المناعة ويعالج السعال البسيط.",
            "الرقص أو الحركة المرحة تحسن اللياقة وتخفف التوتر.",
            "ابتعد عن التدخين تماماً لتحمي رئتيك وقلبك.",
            "الاهتمام بصحة الأسنان ينعكس إيجاباً على الصحة العامة.",
            "التفاؤل والابتسامة يعززان الصحة النفسية والجسدية."
        ];

        function getDailyTip() {
            const startYear = 2024;
            const startMonth = 0; // January
            const startDate = 1;
            const epoch = new Date(startYear, startMonth, startDate).getTime();
            const now = Date.now();
            const dayIndex = Math.floor((now - epoch) / (1000 * 60 * 60 * 24));
            const tipIndex = dayIndex % DAILY_HEALTH_TIPS.length;
            return DAILY_HEALTH_TIPS[tipIndex];
        }

        function showFloatingMotivation() {
            const quote = getDailyQuote();
            showToast(quote, 15000); // Motivational message for 15 seconds
        }

        function getLogicalDate() {
            const now = new Date();
            const profile = loadData('user_profile');
            const endOfDay = (profile && profile.personal && profile.personal.endOfDay) || 6; // Start of day

            if (now.getHours() < endOfDay) {
                const yesterday = new Date(now);
                yesterday.setDate(yesterday.getDate() - 1);
                return yesterday.toISOString().split('T')[0];
            }
            return now.toISOString().split('T')[0];
        }

        let currentPlannerMeal = null;

        function renderMeals() {
            const today = getLogicalDate();
            let todayData = loadData('daily_' + today);
            if (!todayData) {
                initializeTodayData();
                todayData = loadData('daily_' + today);
            }

            const container = document.getElementById('meals-container');
            if (!container) return;

            container.innerHTML = '';

            // Iterate over generic types to ensure order
            ['breakfast', 'lunch', 'dinner', 'snack'].forEach(type => {
                const info = MEAL_TYPES[type];
                // Ensure meal data structure exists
                const mealData = todayData.meals && todayData.meals[type] ? todayData.meals[type] : { items: [], eaten: false };

                // HTML Construction
                const section = document.createElement('div');
                section.className = 'meal-section';

                let foodHtml = '';
                if (mealData.items && mealData.items.length > 0) {
                    const profile = loadData('user_profile');
                    const userConditions = (profile && profile.personal && profile.personal.health) ? profile.personal.health : [];

                    mealData.items.forEach((item, index) => {
                        let tagsHtml = '';
                        let foodImg = 'logo.jpg';
                        if (item.id) {
                            const originalFood = FOOD_DB.find(f => f.id === item.id);
                            if (originalFood) {
                                foodImg = originalFood.image || 'logo.jpg';
                                const report = HealthEngine.evaluate(originalFood, userConditions);
                                if (!report.isSafe && report.warnings) {
                                    report.warnings.forEach(w => {
                                        let className = 'tag-warning';
                                        let icon = '❕';
                                        if (w.level === 'danger') { className = 'tag-danger'; icon = '⚠️'; }
                                        if (w.level === 'success') { className = 'tag-success'; icon = '✅'; }
                                        tagsHtml += `<span class="smart-tag ${className}" style="margin-right:4px;">${icon} ${w.text}</span> `;
                                    });
                                }
                            }
                        }

                        foodHtml += `
                            <div class="food-item" style="display: flex; align-items: center; gap: 12px;">
                                <img src="${foodImg}" style="width: 36px; height: 36px; border-radius: 8px; object-fit: cover; border: 1px solid var(--border);" onerror="this.onerror=null; this.src='logo.jpg';">
                                <div class="food-info" style="flex: 1;">
                                    <span style="display:flex; flex-wrap:wrap; align-items:center; gap:4px;">${item.name} ${tagsHtml}</span>
                                </div>
                                <div style="display:flex; align-items:center;">
                                    <div class="food-cals">${item.cal} سعرة</div>
                                    <button class="btn-delete-food" onclick="deleteFoodFromMeal('${type}', ${index})">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" style="width:14px; height:14px;">
                                            <path d="M3 6h18m-2 0v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                         `;
                    });
                } else {
                    foodHtml = `<div class="empty-meal">لم تضف شيئاً بعد</div>`;
                }

                // SVG Icons inline
                const icons = {
                    breakfast: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><path d="M12 1v2"/><path d="M12 21v2"/><path d="M4.22 4.22l1.42 1.42"/><path d="M18.36 18.36l1.42 1.42"/></svg>',
                    lunch: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2.69l5.66 5.66a8 8 0 11-11.31 0z"/></svg>',
                    dinner: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>',
                    snack: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20a8 8 0 1 0 0-16 8 8 0 0 0 0 16z"/><path d="M12 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/><line x1="12" y1="2" x2="12.01" y2="2"/></svg>'
                };

                const profile = loadData('user_profile');
                const customImg = (profile && profile.personal && profile.personal.mealImages && profile.personal.mealImages[type]) ? profile.personal.mealImages[type] : null;

                section.innerHTML = `
                    <div class="meal-header-row">
                        <div class="meal-title-group" style="display: flex; align-items: center; gap: 12px; width: 100%;">
                            ${customImg ? `<img src="${customImg}" style="width: 48px; height: 48px; border-radius: 12px; object-fit: cover; border: 1px solid var(--border);" onerror="this.onerror=null; this.src='logo.jpg';">` : `<span class="icon icon-md" style="color:var(--text);">${icons[type]}</span>`}
                            <div style="flex: 1;">
                                <h3 style="margin:0;">${info.label}</h3>
                                <div class="meal-desc">${info.desc}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="meal-card ${mealData.eaten ? 'eaten' : ''}">
                        <div class="meal-content">
                            <div class="food-list">
                                ${foodHtml}
                            </div>
                            <button class="btn-add-food" onclick="openPlanner('${type}')">
                                <span class="icon icon-sm"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg></span>
                                إضافة طعام
                            </button>
                        </div>
                     
                    </div>
                `;
                container.appendChild(section);
            });
        }

        function openPlanner(type) {
            currentPlannerMeal = type;
            renderPlanner();
            showPage('page-meal-planner');
        }

        function renderPlanner(categoryFilter = 'all') {
            const list = document.getElementById('planner-list');
            if (!list) return;
            list.innerHTML = '';

            // Update chips
            document.querySelectorAll('.category-chip').forEach(chip => {
                if (categoryFilter === 'all' && chip.textContent === 'الكل') chip.classList.add('active');
                else if (chip.dataset.cat === categoryFilter) chip.classList.add('active');
                else chip.classList.remove('active');
            });

            // Get user profile for health checks
            const profile = loadData('user_profile');
            const userConditions = (profile && profile.personal && profile.personal.health) ? profile.personal.health : [];

            const filtered = categoryFilter === 'all' ? FOOD_DB : FOOD_DB.filter(f => f.cat === categoryFilter);

            filtered.forEach(food => {
                const div = document.createElement('div');
                div.className = 'planner-item';

                // Use HealthEngine for standardized checks
                const report = HealthEngine.evaluate(food, userConditions);
                let tagsHtml = '';

                if (!report.isSafe && report.warnings) {
                    report.warnings.forEach(w => {
                        let className = 'tag-warning';
                        let icon = '❕';
                        if (w.level === 'danger') { className = 'tag-danger'; icon = '⚠️'; }
                        if (w.level === 'success') { className = 'tag-success'; icon = '✅'; }

                        tagsHtml += `<span class="smart-tag ${className}">${icon} ${w.text}</span> `;
                    });
                }

                const imgPath = food.image || 'logo.jpg';

                div.innerHTML = `
                    <div class="planner-item-info" style="flex: 1; display:flex; align-items:center;">
                        <img src="${imgPath}" alt="${food.name}" style="width:48px; height:48px; border-radius:10px; object-fit:cover; margin-left:12px; border:1px solid var(--border);">
                        <div style="flex:1;">
                            <h4 style="display:flex; flex-wrap:wrap; align-items:center; gap:6px; margin:0 0 4px 0;">${food.name} ${tagsHtml}</h4>
                            <div class="planner-item-details">${food.cal} سعرة</div>
                        </div>
                    </div>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <button class="btn-planner-add" onclick="addFoodToMeal('${food.id}'); event.stopPropagation();">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="16" height="16"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                        </button>
                    </div>
                `;
                list.appendChild(div);
            });
        }

        function toggleMealStatus(type) {
            const today = getLogicalDate();
            let todayData = loadData('daily_' + today);
            if (!todayData || !todayData.meals) return;
            if (!todayData.meals[type]) todayData.meals[type] = { items: [], eaten: false };

            todayData.meals[type].eaten = !todayData.meals[type].eaten;

            refreshDailyTotals(todayData);
            saveData('daily_' + today, todayData);
            renderMeals();
        }

        function refreshDailyTotals(todayData) {
            let totalCal = 0;
            let totalP = 0;
            let totalC = 0;
            let totalF = 0;

            if (todayData.meals) {
                Object.keys(todayData.meals).forEach(type => {
                    const meal = todayData.meals[type];
                    if (meal.items) {
                        meal.items.forEach(item => {
                            totalCal += (item.cal || 0);
                            totalP += (item.p || 0);
                            totalC += (item.c || 0);
                            totalF += (item.f || 0);
                        });
                    }
                });
            }

            todayData.totalCalories = Math.round(totalCal);
            todayData.totalProtein = Math.round(totalP);
            todayData.totalCarbs = Math.round(totalC);
            todayData.totalFat = Math.round(totalF);
        }

        function addFoodToMeal(foodId, specificType = null) {
            const type = specificType || currentPlannerMeal;
            const food = FOOD_DB.find(f => f.id === foodId);
            if (!food || !type) return;

            const today = getLogicalDate();
            let todayData = loadData('daily_' + today);
            if (!todayData) {
                initializeTodayData();
                todayData = loadData('daily_' + today);
            }

            if (!todayData.meals || Array.isArray(todayData.meals)) todayData.meals = {};
            if (!todayData.meals[type]) todayData.meals[type] = { items: [], eaten: false };

            // Logic check: if items is array?
            if (!Array.isArray(todayData.meals[type].items)) todayData.meals[type].items = [];

            todayData.meals[type].items.push({
                id: food.id,
                name: food.name,
                cal: food.cal,
                p: food.p || 0,
                c: food.c || 0,
                f: food.f || 0
            });

            // Update daily totals immediately
            refreshDailyTotals(todayData);

            saveData('daily_' + today, todayData);
            showToast('تمت إضافة ' + food.name);

            // If manual add, go back
            if (!specificType) {
                showPage('page-meals');
                renderMeals();
            } else {
                renderMeals(); // Just refresh if suggest
            }
        }

        let currentRecipeId = null;

        function toggleFavorite() {
            if (!currentRecipeId) return;
            // Simple placeholder logic for now
            const btn = document.getElementById('btn-favorite');
            const icon = document.getElementById('icon-fav');

            if (btn.classList.contains('active')) {
                btn.classList.remove('active');
                btn.style.background = 'var(--bg-secondary)';
                btn.style.color = 'var(--text)';
                icon.setAttribute('fill', 'none');
                showToast('تمت الإزالة من المفضلة');
            } else {
                btn.classList.add('active');
                btn.style.background = 'rgba(255, 107, 107, 0.1)';
                btn.style.color = 'var(--danger)';
                icon.setAttribute('fill', 'currentColor');
                showToast('تمت الإضافة للمفضلة');
            }
        }

        function findAlternatives() {
            if (!currentRecipeId) return;
            // Logic to find foods in same category with better stats
            showToast('جاري البحث عن بدائل صحية...');
            // TODO: Implement actual search algorithm
        }

        // showRecipe removed


        function deleteFoodFromMeal(type, index) {
            const today = getLogicalDate();
            let todayData = loadData('daily_' + today);
            if (!todayData || !todayData.meals || !todayData.meals[type]) return;

            const removedItem = todayData.meals[type].items[index];
            if (!removedItem) return;

            todayData.meals[type].items.splice(index, 1);
            refreshDailyTotals(todayData);

            saveData('daily_' + today, todayData);
            renderMeals();
            showToast('تم حذف ' + removedItem.name);
        }

        // Food details functions removed


        // Updated Hook
        const _originalShowPage = showPage;
        showPage = function (pageId) {
            _originalShowPage(pageId);
            if (pageId === 'page-home') updateHome();
            if (pageId === 'page-meals') renderMeals();
            if (pageId === 'page-statistics') updateStatisticsPage();
            checkVerticalScroll();
        };

        // Vertical Scroll Logic
        function checkVerticalScroll() {
            setTimeout(() => {
                const hint = document.getElementById('vertical-scroll-hint');
                if (!hint) return;

                // Check if scrollable
                const docHeight = document.documentElement.scrollHeight;
                const winHeight = window.innerHeight;
                const scrollTop = window.scrollY;

                if (docHeight > winHeight + 50 && scrollTop < 50) {
                    hint.classList.add('visible');
                } else {
                    hint.classList.remove('visible');
                }
            }, 300); // Small delay to allow render
        }

        window.addEventListener('scroll', () => {
            const hint = document.getElementById('vertical-scroll-hint');
            if (hint && hint.classList.contains('visible')) {
                hint.classList.remove('visible');
            }
        }, { passive: true });

        window.addEventListener('resize', checkVerticalScroll);
    </script>
    <!-- Vertical Scroll Indicator -->
    <div id="vertical-scroll-hint" class="vertical-scroll-hint">
        <span>مرر للمزيد</span>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
            stroke-linejoin="round" style="width: 14px; height: 14px;">
            <path d="M7 13l5 5 5-5M7 6l5 5 5-5" />
        </svg>
    </div>
</body>

</html>